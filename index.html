<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>StockMind AI â€” ì‹¤ì‹œê°„ ì£¼ì‹ ë¶„ì„</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+KR:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<style>
:root{--bg:#07090d;--bg2:#0d1117;--bg3:#161b22;--brd:#21262d;--acc:#00d4aa;--ac3:#7c3aed;--tx:#e6edf3;--tx2:#8b949e;--tx3:#484f58;--up:#3fb950;--dn:#f85149;--r:12px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--tx);font-family:'Noto Sans KR',sans-serif;min-height:100vh;overflow-x:hidden}
/* header */
header{position:sticky;top:0;z-index:100;background:rgba(7,9,13,.96);backdrop-filter:blur(16px);border-bottom:1px solid var(--brd);display:flex;align-items:center;padding:0 28px;height:56px;gap:20px}
.logo{font-family:'Bebas Neue',sans-serif;font-size:1.55rem;letter-spacing:2px;flex-shrink:0}.logo span{color:var(--acc)}
.tb{flex:1;overflow:hidden;position:relative}
.tb::before,.tb::after{content:'';position:absolute;top:0;bottom:0;width:48px;z-index:2;pointer-events:none}
.tb::before{left:0;background:linear-gradient(to right,#07090d,transparent)}
.tb::after{right:0;background:linear-gradient(to left,#07090d,transparent)}
.tb-track{display:flex;gap:32px;white-space:nowrap;animation:ticker 42s linear infinite}
.tb-track:hover{animation-play-state:paused}
@keyframes ticker{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.ti{font-family:'JetBrains Mono',monospace;font-size:.75rem;color:var(--tx2);display:inline-flex;align-items:center;gap:7px;cursor:pointer;flex-shrink:0;transition:color .2s}
.ti:hover{color:var(--tx)}.ti b{color:var(--tx)}.cu{color:var(--up)}.cd{color:var(--dn)}
/* main */
main{max-width:1100px;margin:0 auto;padding:0 24px 80px}
/* hero */
.hero{padding:70px 0 48px;text-align:center}
.hero-badge{display:inline-block;margin-bottom:22px;font-family:'JetBrains Mono',monospace;font-size:.7rem;letter-spacing:3px;text-transform:uppercase;color:var(--acc);border:1px solid rgba(0,212,170,.28);padding:4px 16px;border-radius:100px}
.hero h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(2.8rem,8vw,5.2rem);line-height:1.06;letter-spacing:1px;margin-bottom:14px}
.hero h1 em{font-style:normal;color:var(--acc)}
.hero-sub{color:var(--tx2);font-size:.95rem;line-height:1.9;margin-bottom:38px}
/* search */
.sw{position:relative;max-width:680px;margin:0 auto 20px}
.sb{display:flex;align-items:center;background:var(--bg3);border:1.5px solid var(--brd);border-radius:14px;padding:6px 6px 6px 18px;gap:10px;transition:border-color .25s,box-shadow .25s}
.sb:focus-within{border-color:var(--acc);box-shadow:0 0 0 3px rgba(0,212,170,.1),0 8px 28px rgba(0,0,0,.4)}
.sico{width:20px;height:20px;color:var(--tx3);flex-shrink:0}
#q{flex:1;background:none;border:none;outline:none;color:var(--tx);font-family:'Noto Sans KR',sans-serif;font-size:1rem;padding:10px 0}
#q::placeholder{color:var(--tx3)}
#btn{background:var(--acc);color:var(--bg);border:none;border-radius:10px;padding:12px 24px;font-family:'Noto Sans KR',sans-serif;font-weight:700;font-size:.9rem;cursor:pointer;white-space:nowrap;transition:background .2s,transform .15s}
#btn:hover{background:#00bfa0;transform:translateY(-1px)}#btn:active{transform:none}#btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
/* suggest */
#sug{position:absolute;top:calc(100% + 6px);left:0;right:0;background:var(--bg3);border:1px solid var(--brd);border-radius:12px;overflow:hidden;z-index:60;display:none;box-shadow:0 16px 48px rgba(0,0,0,.6)}
#sug.open{display:block}
.sgr{display:flex;justify-content:space-between;align-items:center;padding:11px 16px;cursor:pointer;border-bottom:1px solid var(--brd);transition:background .15s}
.sgr:last-child{border-bottom:none}.sgr:hover,.sgr.active{background:rgba(255,255,255,.06)}
.sgr-nm{font-size:.9rem;font-weight:500}.sgr-sub{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--tx2);margin-top:2px}
.sgr-bdg{font-size:.64rem;padding:2px 8px;border-radius:100px;font-weight:700;flex-shrink:0}
.bk{background:rgba(124,58,237,.18);color:#a78bfa}.bq{background:rgba(0,212,170,.14);color:var(--acc)}.bu{background:rgba(255,107,53,.14);color:#ff6b35}
.sgl{padding:14px 16px;color:var(--tx3);font-size:.84rem;display:flex;align-items:center;gap:8px}
.sgl-spin{width:14px;height:14px;border:2px solid transparent;border-top-color:var(--acc);border-radius:50%;animation:spin .7s linear infinite;flex-shrink:0}
/* ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ */
.sg-empty{padding:18px 16px;text-align:center}
.sg-empty-icon{font-size:1.8rem;margin-bottom:6px}
.sg-empty-txt{color:var(--tx2);font-size:.84rem;margin-bottom:4px}
.sg-empty-hint{color:var(--tx3);font-size:.76rem;font-family:'JetBrains Mono',monospace}
/* chips */
.chips{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.chip{background:var(--bg3);border:1px solid var(--brd);color:var(--tx2);border-radius:100px;padding:5px 16px;font-family:'JetBrains Mono',monospace;font-size:.76rem;cursor:pointer;transition:all .2s}
.chip:hover,.chip.on{background:var(--acc);color:var(--bg);border-color:var(--acc)}
/* worker ë°°ë„ˆ - ì¡°ìš©í•œ ìŠ¤íƒ€ì¼ */
#wbanner{display:none;margin-top:14px;border-radius:10px;padding:12px 18px;background:rgba(248,81,73,.06);border:1px solid rgba(248,81,73,.2);display:flex;align-items:center;gap:10px}
#wbanner.hidden{display:none}
.wb-icon{color:var(--dn);font-size:1rem;flex-shrink:0}
.wb-txt{font-size:.82rem;color:var(--tx2);line-height:1.6}
.wb-txt strong{color:var(--dn)}
.wb-txt code{color:var(--acc);font-family:'JetBrains Mono',monospace;font-size:.8rem;background:rgba(0,212,170,.08);padding:1px 5px;border-radius:3px}
/* result */
.rs{margin-top:16px;animation:fu .4s ease both}
@keyframes fu{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:none}}
.rh{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);padding:24px 28px;margin-bottom:14px;position:relative;overflow:hidden}
.rh::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(to right,var(--acc),var(--ac3))}
.rmeta{display:flex;gap:10px;align-items:center;margin-bottom:7px}
.rmkt{font-family:'JetBrains Mono',monospace;font-size:.68rem;padding:2px 9px;border-radius:100px;background:rgba(0,212,170,.13);color:var(--acc);font-weight:700}
.rtime{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--tx3)}
.rname-row{display:flex;align-items:center;gap:10px;margin-bottom:12px;flex-wrap:wrap}
.rname-row h2{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:1px}
.rtick{font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--tx2);background:var(--bg3);border:1px solid var(--brd);padding:2px 10px;border-radius:7px}
.rprice-row{display:flex;align-items:baseline;gap:12px;flex-wrap:wrap}
.rprice{font-family:'JetBrains Mono',monospace;font-size:2.4rem;font-weight:700}
.rchg{font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:700}
.rchg.up{color:var(--up)}.rchg.dn{color:var(--dn)}
/* chart + stats */
.dg{display:grid;grid-template-columns:1fr 320px;gap:14px;margin-bottom:14px}
@media(max-width:780px){.dg{grid-template-columns:1fr}}
.cc,.sc{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);padding:20px}
.sec-lbl{font-family:'JetBrains Mono',monospace;font-size:.68rem;letter-spacing:2px;text-transform:uppercase;color:var(--tx3);margin-bottom:14px}
#mychart{width:100%!important;height:215px!important}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:7px}
.stat-box{background:var(--bg3);border-radius:8px;padding:10px 12px}
.stat-l{font-family:'JetBrains Mono',monospace;font-size:.57rem;letter-spacing:1px;text-transform:uppercase;color:var(--tx3);margin-bottom:4px}
.stat-v{font-family:'JetBrains Mono',monospace;font-size:.86rem;font-weight:700}
/* AI panel */
.ap{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);padding:24px 28px;position:relative;overflow:hidden}
.ap::before{content:'';position:absolute;inset:0;pointer-events:none;background:radial-gradient(ellipse at top left,rgba(124,58,237,.06),transparent 55%)}
.ap-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
.ap-ttl{display:flex;align-items:center;gap:7px;font-weight:700;color:var(--acc);font-size:.95rem}
.ap-sub{font-family:'JetBrains Mono',monospace;font-size:.64rem;color:var(--tx3);padding:2px 9px;border:1px solid var(--brd);border-radius:100px}
.ai-loading{display:flex;align-items:center;gap:12px;padding:22px 0;color:var(--tx2);font-size:.86rem}
.spinner{width:30px;height:30px;flex-shrink:0;border:3px solid transparent;border-top-color:var(--acc);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
/* AI content */
.ai-sec{margin-bottom:22px}.ai-sec:last-child{margin-bottom:0}
.ai-stitle{font-family:'JetBrains Mono',monospace;font-size:.67rem;letter-spacing:2px;text-transform:uppercase;color:var(--acc);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid rgba(0,212,170,.15)}
.verdict-row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0;align-items:center}
.vbadge{padding:6px 16px;border-radius:100px;font-weight:700;font-size:.83rem;font-family:'JetBrains Mono',monospace}
.vbadge.sbuy{background:rgba(0,212,170,.2);color:#00d4aa;border:1px solid rgba(0,212,170,.5)}
.vbadge.buy{background:rgba(63,185,80,.13);color:var(--up);border:1px solid rgba(63,185,80,.3)}
.vbadge.watch{background:rgba(124,58,237,.13);color:#a78bfa;border:1px solid rgba(124,58,237,.3)}
.vbadge.hold{background:rgba(255,179,0,.13);color:#ffb300;border:1px solid rgba(255,179,0,.3)}
.vbadge.sell{background:rgba(248,81,73,.13);color:var(--dn);border:1px solid rgba(248,81,73,.3)}
.vbadge.ssell{background:rgba(200,0,0,.18);color:#ff2d2d;border:1px solid rgba(200,0,0,.4)}
.vbadge.low{background:rgba(63,185,80,.1);color:var(--up);border:1px solid rgba(63,185,80,.2)}
.vbadge.mid{background:rgba(255,179,0,.1);color:#ffb300;border:1px solid rgba(255,179,0,.2)}
.vbadge.high{background:rgba(248,81,73,.1);color:var(--dn);border:1px solid rgba(248,81,73,.2)}
.vbadge.veryhigh{background:rgba(200,0,0,.14);color:#ff2d2d;border:1px solid rgba(200,0,0,.35)}
.score-chip{font-family:'JetBrains Mono',monospace;font-size:.72rem;color:var(--tx3);padding:3px 10px;border:1px solid var(--brd);border-radius:100px}
.ai-reason{color:#c9d1d9;line-height:1.9;margin-top:10px;font-size:.9rem}
.strat-row{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.strat-box{flex:1;min-width:90px;background:var(--bg3);border-radius:9px;padding:12px;text-align:center}
.strat-l{font-family:'JetBrains Mono',monospace;font-size:.57rem;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px}
.strat-v{font-family:'JetBrains Mono',monospace;font-size:.88rem;font-weight:700;line-height:1.35}
.s-buy .strat-v{color:var(--up)}.s-sell .strat-v,.s-zone-sell .strat-v{color:var(--dn)}.s-stop .strat-v{color:#ff6b35}.s-mid .strat-v{color:var(--acc)}
.ai-note{color:var(--tx2);font-size:.82rem;margin-top:5px;line-height:1.7}
.scen-row{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.scen-box{flex:1;min-width:130px;background:var(--bg3);border-radius:9px;padding:12px}
.scen-l{font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px}
.scen-p{font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:700;margin-bottom:4px}
.scen-box.bull .scen-p{color:var(--up)}.scen-box.base .scen-p{color:var(--acc)}.scen-box.bear .scen-p{color:var(--dn)}
.scen-d{color:var(--tx2);font-size:.78rem;line-height:1.6}
.risk-bar-row{display:flex;align-items:center;gap:10px;margin:10px 0}
.rb-lbl{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--tx2);width:50px}
.rb-track{flex:1;height:7px;background:var(--bg3);border-radius:100px;overflow:hidden}
.rb-fill{height:100%;border-radius:100px;transition:width 1.2s ease}
.rb-fill.low{background:var(--up)}.rb-fill.mid{background:#ffb300}.rb-fill.high{background:var(--dn)}.rb-fill.veryhigh{background:#ff2d2d}
.rb-pct{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--tx2);width:30px;text-align:right}
.risk-list{list-style:none;margin-top:10px}
.risk-list li{display:flex;gap:8px;align-items:flex-start;padding:5px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.85rem;color:var(--tx2);line-height:1.65}
.risk-list li:last-child{border-bottom:none}.risk-list li::before{content:'â–¸';color:var(--dn);flex-shrink:0;margin-top:2px}
.watch-list{list-style:none;margin-top:8px;counter-reset:wc}
.watch-list li{counter-increment:wc;display:flex;gap:10px;align-items:flex-start;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.85rem;color:#c9d1d9;line-height:1.65}
.watch-list li:last-child{border-bottom:none}
.watch-list li::before{content:counter(wc);font-family:'JetBrains Mono',monospace;font-size:.7rem;font-weight:700;color:var(--acc);background:rgba(0,212,170,.1);min-width:20px;height:20px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px}
/* popular */
.ps{margin-top:52px}
.ps-l{font-family:'JetBrains Mono',monospace;font-size:.68rem;letter-spacing:3px;text-transform:uppercase;color:var(--tx3);margin-bottom:14px}
.pop-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(188px,1fr));gap:11px}
.pop-card{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);padding:16px;cursor:pointer;transition:border-color .2s,transform .2s,box-shadow .2s;position:relative;overflow:hidden}
.pop-card::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(to right,var(--acc),var(--ac3));transform:scaleX(0);transition:transform .3s}
.pop-card:hover{border-color:rgba(0,212,170,.45);transform:translateY(-3px);box-shadow:0 10px 26px rgba(0,0,0,.4)}.pop-card:hover::after{transform:scaleX(1)}
.pop-mkt{font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--tx3);margin-bottom:3px}
.pop-name{font-weight:700;font-size:.88rem;margin-bottom:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pop-price{font-family:'JetBrains Mono',monospace;font-size:1.02rem;font-weight:700;margin-bottom:2px}
.pop-chg{font-family:'JetBrains Mono',monospace;font-size:.74rem;font-weight:700}
.pop-chg.up{color:var(--up)}.pop-chg.dn{color:var(--dn)}.pop-chg.na{color:var(--tx3)}
.sk{height:112px;border-radius:var(--r);border:1px solid var(--brd);background:linear-gradient(90deg,var(--bg2) 0%,var(--bg3) 50%,var(--bg2) 100%);background-size:200% 100%;animation:sk 1.4s infinite}
@keyframes sk{to{background-position:-200% 0}}
/* toast */
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#0d1117;border:1px solid var(--brd);color:var(--tx2);padding:10px 22px;border-radius:11px;font-size:.84rem;z-index:9999;box-shadow:0 8px 28px rgba(0,0,0,.6);max-width:88vw;text-align:center;line-height:1.5;animation:fu .3s ease}
.toast.err{border-color:var(--dn);color:var(--dn)}
.toast.ok{border-color:var(--up);color:var(--up)}
footer{text-align:center;padding:24px;border-top:1px solid var(--brd);color:var(--tx3);font-size:.74rem;line-height:2}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--brd);border-radius:2px}
@media(max-width:560px){header{padding:0 12px}main{padding:0 12px 56px}.hero{padding:38px 0 30px}.rh,.ap{padding:14px}.rprice{font-size:1.9rem}#btn{padding:12px 14px;font-size:.84rem}}
</style>
</head>
<body>
<header>
  <div class="logo">STOCK<span>MIND</span></div>
  <div class="tb"><div class="tb-track" id="tbTrack"><span style="color:#484f58;font-size:.75rem;font-family:'JetBrains Mono',monospace">ë¡œë”© ì¤‘...</span></div></div>
</header>
<main>
  <section class="hero">
    <div class="hero-badge">AI ì£¼ì‹ ë¶„ì„ í”Œë«í¼</div>
    <h1>ì£¼ì‹ì„ ê²€ìƒ‰í•˜ê³ <br><em>AIì˜ ëˆˆ</em>ìœ¼ë¡œ ë³´ë¼</h1>
    <p class="hero-sub">ì½”ìŠ¤í”¼ Â· ì½”ìŠ¤ë‹¥ Â· ë¯¸êµ­ ì£¼ì‹ ì‹¤ì‹œê°„ ë¶„ì„<br>ì–¸ì œ ì‚¬ê³  íŒ”ì§€, AIê°€ êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤</p>
    <div class="sw">
      <div class="sb">
        <svg class="sico" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input id="q" type="text" placeholder="ì¢…ëª©ëª… ë˜ëŠ” ì½”ë“œ ê²€ìƒ‰ (ì‚¼ì„±ì „ì, ì´ê±´í™€ë”©ìŠ¤, AAPL, 005930...)" autocomplete="off" spellcheck="false">
        <button id="btn">ë¶„ì„í•˜ê¸°</button>
      </div>
      <div id="sug"></div>
    </div>
    <div class="chips">
      <button class="chip on">ì „ì²´</button>
      <button class="chip">KOSPI</button>
      <button class="chip">KOSDAQ</button>
      <button class="chip">ë¯¸êµ­</button>
    </div>
    <!-- Worker ì—†ì„ ë•Œ ë°°ë„ˆ: ë”± í•œ ë²ˆë§Œ, ì¡°ìš©í•˜ê²Œ -->
    <div id="wbanner" class="hidden">
      <span class="wb-icon">âš </span>
      <div class="wb-txt"><strong>_worker.js ë¯¸ë°°í¬</strong> â€” GitHub ë£¨íŠ¸ì— <code>_worker.js</code> íŒŒì¼ì„ ì˜¬ë ¤ì£¼ì„¸ìš”. ë°°í¬ í›„ ìƒˆë¡œê³ ì¹¨í•˜ë©´ ëª¨ë“  ê¸°ëŠ¥ì´ í™œì„±í™”ë©ë‹ˆë‹¤.</div>
    </div>
  </section>


  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7938956361770773"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-7938956361770773"
     data-ad-slot="3808518808"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  
  
  <section id="rs" style="display:none">
    <div class="rh">
      <div class="rmeta"><span class="rmkt" id="rMkt"></span><span class="rtime" id="rTime"></span></div>
      <div class="rname-row"><h2 id="rName"></h2><span class="rtick" id="rTick"></span></div>
      <div class="rprice-row"><span class="rprice" id="rPr"></span><span class="rchg" id="rCh"></span></div>
    </div>
    <div class="dg">
      <div class="cc"><div class="sec-lbl">ê°€ê²© ì°¨íŠ¸ (ìµœê·¼ 30ì¼)</div><canvas id="mychart"></canvas></div>
      <div class="sc"><div class="sec-lbl">í•µì‹¬ ì§€í‘œ</div><div class="stats-grid" id="statsGrid"></div></div>
    </div>
    <div class="ap">
      <div class="ap-hdr">
        <div class="ap-ttl">
          <svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
          AI ë¶„ì„ ë¦¬í¬íŠ¸
        </div>
        <span class="ap-sub">Claude AI</span>
      </div>
      <div class="ai-loading" id="aiLoad"><div class="spinner"></div><span>ë°ì´í„° ë¶„ì„ ì¤‘...</span></div>
      <div id="aiCont" style="display:none"></div>
    </div>
  </section>

  <section class="ps">
    <div class="ps-l">ì¸ê¸° ì¢…ëª©</div>
    <div class="pop-grid" id="popGrid">
      <div class="sk"></div><div class="sk"></div><div class="sk"></div>
      <div class="sk"></div><div class="sk"></div><div class="sk"></div>
    </div>
  </section>
</main>
<footer>
  <p>StockMind AI Â· íˆ¬ìëŠ” ë³¸ì¸ ì±…ì„ì…ë‹ˆë‹¤ Â· ì •ë³´ ì œê³µ ëª©ì ì´ë©° íˆ¬ì ê¶Œìœ ê°€ ì•„ë‹™ë‹ˆë‹¤</p>
  <p style="font-family:'JetBrains Mono',monospace;font-size:.65rem;margin-top:4px">Naver Finance Â· Yahoo Finance Â· Claude AI Â· Cloudflare Pages</p>
</footer>

<script>
(function() {
'use strict';

// â”€â”€ ë¯¸êµ­ ì£¼ì‹ ë¡œì»¬ DB â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var US_DB = [
  {c:'AAPL',m:'NASDAQ',n:'Apple',f:'Apple Inc'},
  {c:'MSFT',m:'NASDAQ',n:'Microsoft',f:'Microsoft Corp'},
  {c:'GOOGL',m:'NASDAQ',n:'Alphabet',f:'Alphabet Inc'},
  {c:'AMZN',m:'NASDAQ',n:'Amazon',f:'Amazon.com'},
  {c:'NVDA',m:'NASDAQ',n:'NVIDIA',f:'NVIDIA Corp'},
  {c:'META',m:'NASDAQ',n:'Meta',f:'Meta Platforms'},
  {c:'TSLA',m:'NASDAQ',n:'Tesla',f:'Tesla Inc'},
  {c:'TSM',m:'NYSE',n:'TSMC',f:'Taiwan Semiconductor'},
  {c:'AVGO',m:'NASDAQ',n:'Broadcom',f:'Broadcom Inc'},
  {c:'NFLX',m:'NASDAQ',n:'Netflix',f:'Netflix Inc'},
  {c:'AMD',m:'NASDAQ',n:'AMD',f:'Advanced Micro Devices'},
  {c:'INTC',m:'NASDAQ',n:'Intel',f:'Intel Corp'},
  {c:'DIS',m:'NYSE',n:'Disney',f:'Walt Disney'},
  {c:'JPM',m:'NYSE',n:'JP Morgan',f:'JPMorgan Chase'},
  {c:'V',m:'NYSE',n:'Visa',f:'Visa Inc'},
  {c:'WMT',m:'NYSE',n:'Walmart',f:'Walmart Inc'},
  {c:'PLTR',m:'NASDAQ',n:'Palantir',f:'Palantir Technologies'},
  {c:'COIN',m:'NASDAQ',n:'Coinbase',f:'Coinbase Global'},
  {c:'ARM',m:'NASDAQ',n:'Arm Holdings',f:'Arm Holdings'},
  {c:'UBER',m:'NYSE',n:'Uber',f:'Uber Technologies'},
  {c:'ORCL',m:'NYSE',n:'Oracle',f:'Oracle Corp'},
  {c:'SMCI',m:'NASDAQ',n:'Super Micro',f:'Super Micro Computer'}
];

// í•œêµ­ì–´ ë³„ì¹­ â†’ ì¢…ëª©ì½”ë“œ
var KR_AL = {
  'ì‚¼ì„±':'005930','ì‚¼ì„±ì „ì':'005930','í•˜ì´ë‹‰ìŠ¤':'000660','skí•˜ì´ë‹‰ìŠ¤':'000660',
  'ë„¤ì´ë²„':'035420','ì¹´ì¹´ì˜¤':'035720','í˜„ëŒ€ì°¨':'005380','í˜„ëŒ€ìë™ì°¨':'005380',
  'ê¸°ì•„':'000270','ê¸°ì•„ì°¨':'000270','ì…€íŠ¸ë¦¬ì˜¨':'068270','ì¹´ì¹´ì˜¤ë±…í¬':'323410',
  'í¬ë˜í”„í†¤':'259960','í•˜ì´ë¸Œ':'352820','ì—”ì”¨':'036570','ì—”ì”¨ì†Œí”„íŠ¸':'036570',
  'ë„·ë§ˆë¸”':'251270','kt':'030200','skt':'017670','skí…”ë ˆì½¤':'017670',
  'lgì „ì':'066570','lg':'003550','ì‚¼ì„±sdi':'006400','sdi':'006400',
  'ì‹ í•œ':'055550','ì‹ í•œê¸ˆìœµ':'055550','kb':'105560','kbê¸ˆìœµ':'105560',
  'í•œì „':'015760','í•œêµ­ì „ë ¥':'015760','ì´ê±´í™€ë”©ìŠ¤':'039020','ì´ê±´ì‚°ì—…':'008250',
  'ì—ì½”í”„ë¡œë¹„ì— ':'247540','ì—ì½”í”„ë¡œ':'086520','í¬ìŠ¤ì½”':'005490','posco':'005490',
  'ì—ìŠ¤ì— ':'041510','jyp':'035900','ë‘ì‚°ì—ë„ˆë¹Œë¦¬í‹°':'034020',
  'ì¹´ì¹´ì˜¤í˜ì´':'377300','ìš°ë¦¬ê¸ˆìœµ':'316140','ìš°ë¦¬ì€í–‰':'000030',
  'í•˜ë‚˜ê¸ˆìœµ':'086790','ê¸°ì—…ì€í–‰':'024110','ëŒ€ìš°ì¡°ì„ ':'042660',
  'hy':'001840','ë†ì‹¬':'004370','cj':'001040','ì˜¤ë¦¬ì˜¨':'271560',
  'ë¡¯ë°ì¼€ë¯¸ì¹¼':'011170','ì½”ì˜¤ë¡±':'002020','í•œí™”':'000880',
  'í˜„ëŒ€ê±´ì„¤':'000720','ëŒ€ë¦¼':'000210','gsê±´ì„¤':'006360',
};
var US_AL = {
  'nvidia':'NVDA','ì—”ë¹„ë””ì•„':'NVDA','tesla':'TSLA','í…ŒìŠ¬ë¼':'TSLA',
  'apple':'AAPL','ì• í”Œ':'AAPL','microsoft':'MSFT','ë§ˆì´í¬ë¡œì†Œí”„íŠ¸':'MSFT',
  'google':'GOOGL','êµ¬ê¸€':'GOOGL','amazon':'AMZN','ì•„ë§ˆì¡´':'AMZN',
  'meta':'META','ë©”íƒ€':'META','netflix':'NFLX','ë„·í”Œë¦­ìŠ¤':'NFLX',
  'intel':'INTC','ì¸í…”':'INTC','disney':'DIS','ë””ì¦ˆë‹ˆ':'DIS',
  'palantir':'PLTR','íŒ”ë€í‹°ì–´':'PLTR','broadcom':'AVGO','tsmc':'TSM',
  'coinbase':'COIN','arm':'ARM','oracle':'ORCL','walmart':'WMT',
};

// â”€â”€ ìœ í‹¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function G(id) { return document.getElementById(id); }
function isKR(s) { return s && (s.endsWith('.KS') || s.endsWith('.KQ')); }
function isValidSym(s) {
  if (!s) return false;
  if (/^\d{6}\.(KS|KQ)$/.test(s)) return true;  // í•œêµ­ ì¢…ëª©ì½”ë“œ
  if (/^[A-Z]{1,5}$/.test(s)) return true;         // ë¯¸êµ­ í‹°ì»¤
  if (/^[A-Z]{1,5}\.(KS|KQ)$/.test(s)) return false; // ì˜ëª»ëœ í˜•ì‹
  return false;
}

// í¬ë§·
function fmtNum(v, dec) {
  var n = parseFloat(String(v || 0).replace(/,/g, ''));
  if (!isFinite(n) || n === 0) return 'â€”';
  return n.toLocaleString('ko-KR', { maximumFractionDigits: dec === undefined ? 2 : dec });
}
function fmtPrice(v, isKRW) {
  var n = parseFloat(String(v || 0).replace(/,/g, ''));
  if (!isFinite(n) || n === 0) return 'â€”';
  if (isKRW) return fmtNum(n, 0) + 'ì›';
  return '$' + (n >= 100 ? fmtNum(n, 2) : fmtNum(n, 4));
}
function fmtPct(v) {
  var n = parseFloat(v || 0);
  if (!isFinite(n)) return '';
  return (n >= 0 ? '+' : '') + n.toFixed(2) + '%';
}
function fmtCap(v, isKRW) {
  if (!v || v <= 0) return 'â€”';
  if (isKRW) {
    if (v >= 1e12) return fmtNum(v / 1e12, 1) + 'ì¡°ì›';
    if (v >= 1e8)  return fmtNum(v / 1e8, 0)  + 'ì–µì›';
    return fmtNum(v, 0) + 'ì›';
  }
  return '$' + fmtNum(v / 1e9, 1) + 'B';
}
function fmtFgn(v) {
  var n = parseFloat(v || 0);
  return (isFinite(n) && n > 0) ? n.toFixed(2) + '%' : 'â€”';
}

// â”€â”€ Worker ìƒíƒœ ê´€ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ë°°ë„ˆë¥¼ ë”± í•œ ë²ˆë§Œ, ëª…í™•í•˜ê²Œ í‘œì‹œ
var workerOK = null; // null=ë¯¸í™•ì¸, true=ìˆìŒ, false=ì—†ìŒ

function markWorkerOK() {
  workerOK = true;
  G('wbanner').classList.add('hidden');
}
function markWorkerFail() {
  if (workerOK === true) return; // ì´ë¯¸ ì •ìƒ í™•ì¸ëìœ¼ë©´ ë¬´ì‹œ
  workerOK = false;
  G('wbanner').classList.remove('hidden');
}

// â”€â”€ API í˜¸ì¶œ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Worker ì—†ìœ¼ë©´ ë°°ë„ˆ í‘œì‹œ (ì¤‘ë³µ ë°©ì§€), ì—ëŸ¬ëŠ” throwí•´ì„œ í˜¸ì¶œìê°€ ì²˜ë¦¬
function apiCall(params) {
  var qs = Object.keys(params).map(function(k) {
    return encodeURIComponent(k) + '=' + encodeURIComponent(params[k]);
  }).join('&');
  return fetch('/api/stock?' + qs).then(function(r) {
    var ct = r.headers.get('content-type') || '';
    if (!ct.includes('json')) {
      markWorkerFail();
      throw new Error('WORKER_MISSING');
    }
    return r.json();
  }).then(function(j) {
    markWorkerOK();
    if (!j.ok) throw new Error(j.error || 'ë°ì´í„° ì—†ìŒ');
    return j;
  });
}

// ì¡°ìš©í•œ API í˜¸ì¶œ (ì‹¤íŒ¨í•´ë„ null ë°˜í™˜, ì—ëŸ¬ ì•ˆ ë˜ì§)
function apiCallSilent(params) {
  return apiCall(params).catch(function() { return null; });
}

// â”€â”€ ì°¨íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var chartInst = null;
function drawChart(hist, isKRW) {
  var labels = hist.map(function(h) {
    var p = h.date.split('-');
    return p.length === 3 ? (+p[1] + '/' + +p[2]) : h.date;
  });
  var prices = hist.map(function(h) { return h.close; }).filter(function(v) { return v > 0; });
  if (!prices.length) return;
  var ctx = G('mychart').getContext('2d');
  if (chartInst) chartInst.destroy();
  var up  = prices[prices.length - 1] >= prices[0];
  var col = up ? '#3fb950' : '#f85149';
  chartInst = new Chart(ctx, {
    type: 'line',
    data: { labels: labels, datasets: [{ data: prices, borderColor: col, borderWidth: 2.5,
      pointRadius: 0, pointHoverRadius: 5, fill: true, tension: 0.36,
      backgroundColor: function(c) {
        var g = c.chart.ctx.createLinearGradient(0, 0, 0, 220);
        g.addColorStop(0, up ? 'rgba(63,185,80,.25)' : 'rgba(248,81,73,.25)');
        g.addColorStop(1, 'rgba(0,0,0,0)'); return g;
      }
    }]},
    options: { responsive: true, maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: { legend: { display: false },
        tooltip: { backgroundColor: '#0d1117', borderColor: '#21262d', borderWidth: 1,
          titleColor: '#8b949e', bodyColor: '#e6edf3', bodyFont: { family: 'JetBrains Mono', size: 11 }, padding: 10,
          callbacks: { label: function(c) { return ' ' + (isKRW ? fmtNum(c.parsed.y, 0) + 'ì›' : '$' + fmtNum(c.parsed.y, 2)); }}
        }
      },
      scales: {
        x: { grid: { color: 'rgba(33,38,45,.7)' }, ticks: { color: '#484f58', maxTicksLimit: 8, font: { family: 'JetBrains Mono', size: 11 }}},
        y: { grid: { color: 'rgba(33,38,45,.7)' }, ticks: { color: '#484f58', font: { family: 'JetBrains Mono', size: 11 },
          callback: function(v) { return isKRW ? fmtNum(v, 0) : '$' + fmtNum(v, 0); }
        }}
      }
    }
  });
}

// â”€â”€ AI ë¶„ì„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPrompt(sd) {
  var vals   = sd.prices.filter(function(v) { return v > 0; });
  var mx     = vals.length ? Math.max.apply(null, vals) : 0;
  var mn     = vals.length ? Math.min.apply(null, vals) : 0;
  var volPct = mn > 0 ? (((mx - mn) / mn) * 100).toFixed(1) : '3';
  var trend  = vals.length >= 2 ? (vals[vals.length - 1] > vals[0] ? 'ìƒìŠ¹' : 'í•˜ë½') : 'ë³´í•©';
  var recent = vals.slice(-10).map(function(v, i) { return 'D' + (i+1) + ':' + Number(v).toFixed(2); }).join(', ');

  return 'ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ ì£¼ì‹ ì• ë„ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì•„ë˜ ë°ì´í„°ë¥¼ ë¶„ì„í•´ ë°˜ë“œì‹œ ìˆœìˆ˜ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.\n\n' +
    'ì¢…ëª©: ' + sd.name + ' (' + sd.sym + ') | ì‹œì¥: ' + sd.mkt + ' | í†µí™”: ' + sd.currency + '\n' +
    'í˜„ì¬ê°€: ' + sd.priceStr + ' | í˜„ì¬ê°€raw: ' + sd.priceRaw + ' | ë“±ë½: ' + sd.chgPct + '%\n' +
    '52ì£¼ê³ ê°€: ' + sd.h52s + ' | 52ì£¼ê³ ê°€raw: ' + sd.h52raw + '\n' +
    '52ì£¼ì €ê°€: ' + sd.l52s + ' | 52ì£¼ì €ê°€raw: ' + sd.l52raw + '\n' +
    'ê±°ë˜ëŸ‰: ' + sd.vols + ' | ì‹œê°€ì´ì•¡: ' + sd.caps + ' | PER: ' + sd.pers + ' | PBR: ' + sd.pbrs + '\n' +
    'ìµœê·¼10ì¼: ' + recent + ' | íŠ¸ë Œë“œ: ' + trend + ' | ë³€ë™ì„±: ' + volPct + '%\n\n' +
    'JSON:{"verdict":"ì ê·¹ë§¤ìˆ˜|ë§¤ìˆ˜|ì£¼ëª©|ì¤‘ë¦½|ê´€ë§|ë§¤ë„|ê°•ë ¥ë§¤ë„","verdictReason":"3~4ë¬¸ì¥",' +
    '"buyStrategy":{"zone":"êµ¬ê°„","timing":"íƒ€ì´ë°","split":["1ì°¨","2ì°¨"]},' +
    '"sellStrategy":{"shortTarget":"ë‹¨ê¸°","midTarget":"ì¤‘ê¸°","stopLoss":"ì†ì ˆ","exitSignal":"ì‹ í˜¸"},' +
    '"risks":["ë¦¬1","ë¦¬2","ë¦¬3"],"riskLevel":"ë‚®ìŒ|ë³´í†µ|ë†’ìŒ|ë§¤ìš°ë†’ìŒ","riskScore":45,' +
    '"scenarios":{"bull":{"price":"ë‚™ê´€ê°€","desc":"ì„¤ëª…"},"base":{"price":"ê¸°ë³¸ê°€","desc":"ì„¤ëª…"},"bear":{"price":"ë¹„ê´€ê°€","desc":"ì„¤ëª…"}},' +
    '"watchPoints":["í¬1","í¬2","í¬3","í¬4"],"summary":"2ë¬¸ì¥"}';
}

function callAI(sd) {
  return fetch('/api/analyze', {
    method: 'POST', headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ prompt: buildPrompt(sd) })
  }).then(function(r) {
    var ct = r.headers.get('content-type') || '';
    if (!ct.includes('json')) throw new Error('AI ë¯¸ì‘ë‹µ');
    return r.json();
  });
}

function renderAI(r) {
  if (!r || !r.verdict) return;
  var vcMap = { 'ì ê·¹ë§¤ìˆ˜': 'sbuy', 'ë§¤ìˆ˜': 'buy', 'ì£¼ëª©': 'watch', 'ì¤‘ë¦½': 'hold', 'ê´€ë§': 'hold', 'ë§¤ë„': 'sell', 'ê°•ë ¥ë§¤ë„': 'ssell' };
  var vc = vcMap[r.verdict] || 'hold';
  var sc = Math.min(100, Math.max(0, r.riskScore || 50));
  var rlMap = { 'ë‚®ìŒ': 'low', 'ë³´í†µ': 'mid', 'ë†’ìŒ': 'high', 'ë§¤ìš°ë†’ìŒ': 'veryhigh' };
  var rc = rlMap[r.riskLevel] || (sc < 30 ? 'low' : sc < 52 ? 'mid' : sc < 74 ? 'high' : 'veryhigh');
  var isSell = (vc === 'sell' || vc === 'ssell');
  var bs = r.buyStrategy  || {};
  var ss = r.sellStrategy || {};
  var sc2 = r.scenarios   || {};
  var bull = sc2.bull || {}, base = sc2.base || {}, bear = sc2.bear || {};
  var splits = (bs.split && bs.split.length) ? '<p class="ai-note">ë¶„í• : ' + bs.split.join(' â†’ ') + '</p>' : '';
  var timing = bs.timing  ? '<p class="ai-note">íƒ€ì´ë°: ' + bs.timing + '</p>' : '';
  var exit   = ss.exitSignal ? '<p class="ai-note">ìµì ˆ ì‹ í˜¸: ' + ss.exitSignal + '</p>' : '';
  var risks  = (r.risks || []).map(function(x) { return '<li>' + x + '</li>'; }).join('');
  var wpts   = (r.watchPoints || []).map(function(x) { return '<li>' + x + '</li>'; }).join('');
  var zoneClass = isSell ? 's-zone-sell' : 's-buy';
  var zoneLabel = isSell ? 'ë§¤ë„ êµ¬ê°„' : 'ë§¤ìˆ˜ êµ¬ê°„';
  var scoreTag  = (r.score !== undefined) ? '<span class="score-chip">ì ìˆ˜ ' + (r.score > 0 ? '+' : '') + r.score + '</span>' : '';

  G('aiCont').innerHTML =
    '<div class="ai-sec"><div class="ai-stitle">ì¢…í•© íˆ¬ì ì˜ê²¬</div>' +
      '<div class="verdict-row">' +
        '<span class="vbadge ' + vc + '">' + (r.verdict || 'ê´€ë§') + '</span>' +
        '<span class="vbadge ' + rc + '">ë¦¬ìŠ¤í¬ ' + (r.riskLevel || 'ë³´í†µ') + '</span>' +
        scoreTag +
      '</div>' +
      '<p class="ai-reason">' + (r.verdictReason || r.summary || '') + '</p>' +
    '</div>' +
    '<div class="ai-sec"><div class="ai-stitle">ë§¤ìˆ˜ Â· ë§¤ë„ ì „ëµ</div>' +
      '<div class="strat-row">' +
        '<div class="strat-box ' + zoneClass + '"><div class="strat-l">' + zoneLabel + '</div><div class="strat-v">' + (bs.zone || 'â€”') + '</div></div>' +
        '<div class="strat-box s-sell"><div class="strat-l">ë‹¨ê¸° ëª©í‘œê°€</div><div class="strat-v">' + (ss.shortTarget || 'â€”') + '</div></div>' +
        '<div class="strat-box s-mid"><div class="strat-l">ì¤‘ê¸° ëª©í‘œê°€</div><div class="strat-v">' + (ss.midTarget || 'â€”') + '</div></div>' +
        '<div class="strat-box s-stop"><div class="strat-l">ì†ì ˆê°€</div><div class="strat-v">' + (ss.stopLoss || 'â€”') + '</div></div>' +
      '</div>' + splits + timing + exit +
    '</div>' +
    '<div class="ai-sec"><div class="ai-stitle">3ê°œì›” ì‹œë‚˜ë¦¬ì˜¤</div>' +
      '<div class="scen-row">' +
        '<div class="scen-box bull"><div class="scen-l">ğŸŸ¢ ë‚™ê´€</div><div class="scen-p">' + (bull.price || 'â€”') + '</div><div class="scen-d">' + (bull.desc || '') + '</div></div>' +
        '<div class="scen-box base"><div class="scen-l">ğŸ”µ ê¸°ë³¸</div><div class="scen-p">' + (base.price || 'â€”') + '</div><div class="scen-d">' + (base.desc || '') + '</div></div>' +
        '<div class="scen-box bear"><div class="scen-l">ğŸ”´ ë¹„ê´€</div><div class="scen-p">' + (bear.price || 'â€”') + '</div><div class="scen-d">' + (bear.desc || '') + '</div></div>' +
      '</div>' +
    '</div>' +
    '<div class="ai-sec"><div class="ai-stitle">ë¦¬ìŠ¤í¬ ë¶„ì„</div>' +
      '<div class="risk-bar-row"><span class="rb-lbl">ë¦¬ìŠ¤í¬</span><div class="rb-track"><div class="rb-fill ' + rc + '" id="rBar" style="width:0%"></div></div><span class="rb-pct">' + sc + '%</span></div>' +
      '<ul class="risk-list">' + risks + '</ul>' +
    '</div>' +
    '<div class="ai-sec"><div class="ai-stitle">í•µì‹¬ ê´€ì „ í¬ì¸íŠ¸</div><ul class="watch-list">' + wpts + '</ul></div>';

  G('aiCont').style.display = 'block';
  G('aiLoad').style.display = 'none';
  setTimeout(function() { var b = G('rBar'); if (b) b.style.width = sc + '%'; }, 120);
}

// â”€â”€ í† ìŠ¤íŠ¸ (ì—ëŸ¬/ì •ë³´ í‘œì‹œ) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var toastTimer = null;
function showToast(msg, type) {
  document.querySelectorAll('.toast').forEach(function(el) { el.remove(); });
  clearTimeout(toastTimer);
  var el = document.createElement('div');
  el.className = 'toast ' + (type || '');
  el.textContent = msg;
  document.body.appendChild(el);
  toastTimer = setTimeout(function() { if (el.parentNode) el.remove(); }, 5000);
}

// â”€â”€ ê²€ìƒ‰ â†’ ì¢…ëª©ì½”ë“œ í•´ì„ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ë°˜í™˜: { sym: "005930.KS", name: "ì‚¼ì„±ì „ì" } ë˜ëŠ” null
function resolveInput(v) {
  if (!v) return null;
  var lq = v.toLowerCase().replace(/\s+/g, '');

  // 1. í•œêµ­ ë³„ì¹­
  if (KR_AL[lq]) return { sym: KR_AL[lq] + '.KS', name: v };

  // 2. ë¯¸êµ­ ë³„ì¹­
  if (US_AL[lq]) return { sym: US_AL[lq], name: v };

  // 3. 6ìë¦¬ ìˆ«ì ì½”ë“œ
  if (/^\d{6}$/.test(v)) return { sym: v + '.KS', name: v };

  // 4. xxx.KS / xxx.KQ / xxx.KO
  if (/^\d{6}\.(KS|KQ|KO)$/i.test(v)) return { sym: v.toUpperCase().replace('.KO', '.KS'), name: v };

  // 5. ë¯¸êµ­ í‹°ì»¤ (1~5 ì•ŒíŒŒë²³)
  var up = v.toUpperCase();
  if (/^[A-Z]{1,5}$/.test(up)) {
    var found = US_DB.find(function(d) { return d.c === up; });
    if (found) return { sym: up, name: found.n };
    // ëª¨ë¥´ëŠ” í‹°ì»¤ë„ ì‹œë„
    return { sym: up, name: up };
  }

  // 6. í•´ê²° ë¶ˆê°€ â†’ null
  return null;
}

// â”€â”€ ë©”ì¸ ê²€ìƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doSearch(sym, displayName) {
  if (!sym) return;

  // ìœ íš¨ì„± ê²€ì¦ (í•œê¸€ ì¢…ëª©ëª… ë“± ê·¸ëŒ€ë¡œ ë“¤ì–´ì˜¤ë©´ ì°¨ë‹¨)
  if (!isValidSym(sym)) {
    // í•œê¸€/ì˜ë¬¸ ì¢…ëª©ëª…ìœ¼ë¡œ API ê²€ìƒ‰ í›„ ì²« ë²ˆì§¸ ê²°ê³¼ ì‚¬ìš©
    showSugAndSearch(sym);
    return;
  }

  G('rs').style.display = 'none';
  G('btn').disabled = true;
  G('btn').textContent = 'ë¡œë”© ì¤‘...';

  var kr    = isKR(sym);
  var mkt   = kr ? (sym.endsWith('.KQ') ? 'KOSDAQ' : 'KOSPI') : 'US';

  Promise.all([
    apiCall({ action: 'quote', symbol: sym }),
    apiCall({ action: 'chart', symbol: sym, days: 30 })
  ]).then(function(res) {
    var qd   = res[0];
    var hd   = res[1];
    var hist = hd.history || [];
    var prices = hist.map(function(h) { return h.close; }).filter(function(v) { return v > 0; });

    var price     = qd.price     || 0;
    var change    = qd.change    || 0;
    var changePct = qd.changePct || 0;
    var up        = change >= 0;
    var currency  = qd.currency  || (kr ? 'KRW' : 'USD');
    var isKRW     = (currency === 'KRW');

    var priceStr = fmtPrice(price, isKRW);
    var chgStr   = (up ? '+' : '') +
      (isKRW ? fmtNum(change, 0) + 'ì›' : (change >= 0 ? '+$' : '-$') + fmtNum(Math.abs(change), 2)) +
      ' (' + fmtPct(changePct) + ')';

    var h52s  = fmtPrice(qd.high52,     isKRW);
    var l52s  = fmtPrice(qd.low52,      isKRW);
    var vols  = qd.volume > 0 ? fmtNum(qd.volume, 0) : 'â€”';
    var caps  = fmtCap(qd.marketCap,    isKRW);
    var pers  = qd.per > 0   ? fmtNum(qd.per, 2) : 'â€”';
    var pbrs  = qd.pbr > 0   ? fmtNum(qd.pbr, 2) : 'â€”';
    var fgns  = fmtFgn(qd.foreignRatio);
    var opens = fmtPrice(qd.open,        isKRW);

    var name = displayName || qd.name || sym;

    // í—¤ë”
    G('rMkt').textContent  = qd.exchange || mkt;
    G('rTime').textContent = 'ì‹¤ì‹œê°„ Â· ' + new Date().toLocaleTimeString('ko-KR');
    G('rName').textContent = name;
    G('rTick').textContent = sym;
    G('rPr').textContent   = priceStr;
    G('rCh').textContent   = chgStr;
    G('rCh').className     = 'rchg ' + (up ? 'up' : 'dn');

    // ì§€í‘œ ê·¸ë¦¬ë“œ (10ì¹¸)
    var UC = 'var(--up)', DC = 'var(--dn)', AC = 'var(--acc)', TX = 'var(--tx)';
    var CC = up ? UC : DC;
    var stats = [
      { l: 'í˜„ì¬ê°€',    v: priceStr, c: TX },
      { l: 'ë“±ë½ë¥ ',    v: fmtPct(changePct), c: CC },
      { l: '52ì£¼ ê³ ê°€', v: h52s,  c: UC },
      { l: '52ì£¼ ì €ê°€', v: l52s,  c: DC },
      { l: 'ê±°ë˜ëŸ‰',    v: vols,  c: TX },
      { l: 'ì‹œê°€ì´ì•¡',  v: caps,  c: TX },
      { l: 'PER',      v: pers,  c: AC },
      { l: 'PBR',      v: pbrs,  c: AC },
      { l: 'ì‹œê°€',      v: opens, c: TX },
      { l: 'ì™¸êµ­ì¸ë¹„ìœ¨', v: fgns, c: TX },
    ];
    G('statsGrid').innerHTML = stats.map(function(s) {
      return '<div class="stat-box"><div class="stat-l">' + s.l + '</div><div class="stat-v" style="color:' + s.c + '">' + s.v + '</div></div>';
    }).join('');

    if (hist.length) drawChart(hist, isKRW);
    G('rs').style.display = 'block';
    G('rs').scrollIntoView({ behavior: 'smooth', block: 'start' });

    // AI
    G('aiLoad').style.display = 'flex';
    G('aiCont').style.display = 'none';
    G('btn').textContent = 'AI ë¶„ì„ ì¤‘...';

    var sd = {
      sym: sym, mkt: qd.exchange || mkt, name: name,
      currency: currency, priceStr: priceStr,
      priceRaw: price, chgPct: changePct,
      h52s: h52s, l52s: l52s,
      h52raw: qd.high52 || 0,
      l52raw: qd.low52  || 0,
      vols: vols, caps: caps, pers: pers, pbrs: pbrs,
      prices: prices,
    };
    callAI(sd).then(renderAI).catch(function(e) {
      G('aiLoad').style.display = 'none';
      G('aiCont').innerHTML = '<p style="color:#f85149;font-weight:700;margin-bottom:6px">âš  AI ë¶„ì„ ì‹¤íŒ¨</p>' +
        '<p style="color:#8b949e;font-size:.84rem">' + e.message + '</p>';
      G('aiCont').style.display = 'block';
    });

  }).catch(function(e) {
    if (e.message === 'WORKER_MISSING') {
      // ë°°ë„ˆëŠ” ì´ë¯¸ í‘œì‹œë¨ â€” ì¶”ê°€ toast ì—†ìŒ
    } else {
      showToast('âš  ' + e.message, 'err');
    }
  }).finally(function() {
    G('btn').disabled = false;
    G('btn').textContent = 'ë¶„ì„í•˜ê¸°';
  });
}

// ì¢…ëª©ëª…(í•œê¸€/ì˜ë¬¸)ìœ¼ë¡œ ê²€ìƒ‰ í›„ ì²« ê²°ê³¼ë¡œ ìë™ ì§„í–‰
function showSugAndSearch(nameQuery) {
  G('btn').disabled = true;
  G('btn').textContent = 'ê²€ìƒ‰ ì¤‘...';

  fetch('/api/search?q=' + encodeURIComponent(nameQuery))
    .then(function(r) {
      var ct = r.headers.get('content-type') || '';
      if (!ct.includes('json')) { markWorkerFail(); throw new Error('WORKER_MISSING'); }
      return r.json();
    })
    .then(function(d) {
      markWorkerOK();
      var results = d.results || [];
      if (results.length === 0) {
        // ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ â†’ ìë™ì™„ì„±ì— "ê²°ê³¼ ì—†ìŒ" í‘œì‹œ
        G('sug').innerHTML = '<div class="sg-empty">' +
          '<div class="sg-empty-icon">ğŸ”</div>' +
          '<div class="sg-empty-txt"><strong>' + nameQuery + '</strong>ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>' +
          '<div class="sg-empty-hint">ì¢…ëª© ì½”ë“œë¡œ ì§ì ‘ ì…ë ¥í•´ ë³´ì„¸ìš” (ì˜ˆ: 005930)</div>' +
          '</div>';
        G('sug').classList.add('open');
        G('btn').disabled = false;
        G('btn').textContent = 'ë¶„ì„í•˜ê¸°';
        return;
      }
      // ì²« ë²ˆì§¸ ê²°ê³¼ë¡œ ìë™ ê²€ìƒ‰
      var first = results[0];
      G('q').value = first.name;
      hideSug();
      G('btn').disabled = false;
      G('btn').textContent = 'ë¶„ì„í•˜ê¸°';
      doSearch(first.symbol, first.name);
    })
    .catch(function(e) {
      G('btn').disabled = false;
      G('btn').textContent = 'ë¶„ì„í•˜ê¸°';
      if (e.message !== 'WORKER_MISSING') {
        showToast('âš  ê²€ìƒ‰ ì‹¤íŒ¨: ' + e.message, 'err');
      }
    });
}

// â”€â”€ ìë™ì™„ì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var sugTimer = null, sugIdx = -1;

function searchUSLocal(lq) {
  var alias = US_AL[lq];
  if (alias) { var f = US_DB.find(function(d) { return d.c === alias; }); if (f) return [f]; }
  return US_DB.filter(function(d) {
    return d.n.toLowerCase().includes(lq) || d.f.toLowerCase().includes(lq) || d.c.toLowerCase() === lq;
  }).slice(0, 4);
}

function showSug(query) {
  var q = query.trim(), lq = q.toLowerCase().replace(/\s+/g, '');
  if (!q) { hideSug(); return; }
  sugIdx = -1;

  var usHits = searchUSLocal(lq);

  // 6ìë¦¬ ìˆ«ì ì½”ë“œ
  if (/^\d{6}$/.test(q)) {
    renderSugItems([{ symbol: q + '.KS', code: q, name: q + ' (ì§ì ‘ì…ë ¥)', market: 'KOSPI' }], []);
    return;
  }
  // í•œêµ­ ë³„ì¹­ â†’ ì½”ë“œë¡œ ê²€ìƒ‰
  if (KR_AL[lq]) {
    G('sug').innerHTML = '<div class="sgl"><div class="sgl-spin"></div>ê²€ìƒ‰ ì¤‘...</div>';
    G('sug').classList.add('open');
    fetch('/api/search?q=' + encodeURIComponent(KR_AL[lq]))
      .then(function(r) { var ct = r.headers.get('content-type') || ''; return ct.includes('json') ? r.json() : { results: [] }; })
      .then(function(d) { renderSugItems(d.results || [], usHits); })
      .catch(function() { renderSugItems([], usHits); });
    return;
  }
  // ì •í™•í•œ ë¯¸êµ­ í‹°ì»¤
  var uExact = US_DB.find(function(d) { return d.c === q.toUpperCase(); });
  if (uExact) { renderSugItems([], [uExact]); return; }
  // 2ê¸€ì ì´ìƒ: API ê²€ìƒ‰
  if (q.length >= 2) {
    G('sug').innerHTML = '<div class="sgl"><div class="sgl-spin"></div>ê²€ìƒ‰ ì¤‘...</div>';
    G('sug').classList.add('open');
    fetch('/api/search?q=' + encodeURIComponent(q))
      .then(function(r) {
        var ct = r.headers.get('content-type') || '';
        if (!ct.includes('json')) return { results: [] };
        return r.json();
      })
      .then(function(d) { renderSugItems(d.results || [], usHits); })
      .catch(function() { if (usHits.length) renderSugItems([], usHits); else hideSug(); });
  } else if (usHits.length) {
    renderSugItems([], usHits);
  } else {
    hideSug();
  }
}

function renderSugItems(krList, usList) {
  var items = [];
  krList.slice(0, 7).forEach(function(d) {
    items.push({ sym: d.symbol, name: d.name, sub: (d.code || '') + ' Â· ' + (d.market || ''), mkt: d.market || 'KOSPI' });
  });
  usList.forEach(function(u) {
    if (items.length < 9) items.push({ sym: u.c, name: u.n + ' (' + u.f + ')', sub: u.c + ' Â· ' + u.m, mkt: u.m });
  });
  if (!items.length) {
    G('sug').innerHTML = '<div class="sg-empty">' +
      '<div class="sg-empty-icon">ğŸ”</div>' +
      '<div class="sg-empty-txt">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</div>' +
      '<div class="sg-empty-hint">ì¢…ëª© ì½”ë“œë¡œ ì§ì ‘ ê²€ìƒ‰í•˜ê±°ë‚˜ ì˜ì–´ëª…ì„ í™•ì¸í•´ ì£¼ì„¸ìš”</div>' +
      '</div>';
    G('sug').classList.add('open');
    return;
  }
  var mc = { KOSPI: 'bk', KOSDAQ: 'bq', NASDAQ: 'bu', NYSE: 'bu', NMS: 'bu' };
  G('sug').innerHTML = items.map(function(d) {
    var safeName = d.name.replace(/"/g, '&quot;');
    var dispName = d.name.split('(')[0].trim().replace(/&quot;/g, '"');
    return '<div class="sgr" data-sym="' + d.sym + '" data-name="' + safeName + '" data-disp="' + dispName + '">' +
      '<div><div class="sgr-nm">' + d.name + '</div><div class="sgr-sub">' + d.sub + '</div></div>' +
      '<span class="sgr-bdg ' + (mc[d.mkt] || 'bu') + '">' + d.mkt + '</span></div>';
  }).join('');
  G('sug').classList.add('open');
  // í´ë¦­ ë°”ì¸ë”©
  G('sug').querySelectorAll('.sgr').forEach(function(el) {
    el.addEventListener('click', function() {
      var sym  = el.getAttribute('data-sym');
      var disp = el.getAttribute('data-disp') || el.getAttribute('data-name');
      G('q').value = disp;
      hideSug();
      doSearch(sym, disp);
    });
  });
}

function hideSug() { G('sug').classList.remove('open'); sugIdx = -1; }

// ê²€ìƒ‰ ë²„íŠ¼ / ì—”í„° ì²˜ë¦¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function searchFromInput() {
  var v = G('q').value.trim();
  if (!v) return;
  hideSug();

  // í•´ì„ ì‹œë„
  var resolved = resolveInput(v);
  if (resolved && isValidSym(resolved.sym)) {
    doSearch(resolved.sym, v);
  } else {
    // í•´ì„ ë¶ˆê°€ â†’ API ê²€ìƒ‰
    showSugAndSearch(v);
  }
}

// â”€â”€ ì¸ê¸° ì¢…ëª© / í‹°ì»¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var POP = [
  { c: '005930.KS', n: 'ì‚¼ì„±ì „ì' }, { c: '000660.KS', n: 'SKí•˜ì´ë‹‰ìŠ¤' },
  { c: '035420.KS', n: 'NAVER'   }, { c: 'NVDA', n: 'NVIDIA' },
  { c: 'AAPL', n: 'Apple'        }, { c: 'TSLA', n: 'Tesla'  },
];
function loadPop() {
  var pg = G('popGrid');
  Promise.all(POP.map(function(p) {
    return apiCallSilent({ action: 'quote', symbol: p.c })
      .then(function(q) { return { ok: !!q, p: p, q: q }; });
  })).then(function(results) {
    if (results.every(function(r) { return !r.ok; })) {
      // ì „ë¶€ ì‹¤íŒ¨ = Worker ì—†ìŒ
      pg.innerHTML = POP.map(function(p) {
        return '<div class="pop-card" data-c="' + p.c + '">' +
          '<div class="pop-mkt">' + p.c + '</div>' +
          '<div class="pop-name">' + p.n + '</div>' +
          '<div class="pop-price" style="color:#484f58">â€”</div>' +
          '<div class="pop-chg na">ë°ì´í„° ì—†ìŒ</div></div>';
      }).join('');
    } else {
      pg.innerHTML = results.map(function(r) {
        var p = r.p, isKRW = isKR(p.c);
        if (!r.ok || !r.q) return '<div class="pop-card" data-c="' + p.c + '">' +
          '<div class="pop-mkt">' + p.c + '</div><div class="pop-name">' + p.n + '</div>' +
          '<div class="pop-price" style="color:#484f58">â€”</div><div class="pop-chg na">ì˜¤ë¥˜</div></div>';
        var q = r.q, up = (q.changePct || 0) >= 0;
        return '<div class="pop-card" data-c="' + p.c + '">' +
          '<div class="pop-mkt">' + p.c + ' Â· ' + (q.exchange || '') + '</div>' +
          '<div class="pop-name">' + (q.name || p.n) + '</div>' +
          '<div class="pop-price">' + fmtPrice(q.price, isKRW) + '</div>' +
          '<div class="pop-chg ' + (up ? 'up' : 'dn') + '">' + fmtPct(q.changePct) + '</div></div>';
      }).join('');
    }
    pg.querySelectorAll('.pop-card').forEach(function(el) {
      el.addEventListener('click', function() {
        var sym = el.getAttribute('data-c');
        var nm  = el.querySelector('.pop-name') ? el.querySelector('.pop-name').textContent : sym;
        doSearch(sym, nm);
      });
    });
  });
}

var TICK = [
  { c: '005930.KS', n: 'ì‚¼ì„±ì „ì' }, { c: '000660.KS', n: 'SKí•˜ì´ë‹‰ìŠ¤' },
  { c: '035420.KS', n: 'NAVER'   }, { c: 'NVDA', n: 'NVIDIA' },
  { c: 'AAPL', n: 'Apple'        }, { c: 'TSLA', n: 'Tesla'  },
  { c: 'MSFT', n: 'Microsoft'    }, { c: '035720.KS', n: 'ì¹´ì¹´ì˜¤' },
];
function loadTicker() {
  Promise.all(TICK.map(function(t) {
    return apiCallSilent({ action: 'quote', symbol: t.c })
      .then(function(q) { return q ? { ok: true, t: t, price: q.price, pct: q.changePct, isKRW: isKR(t.c) } : null; });
  })).then(function(results) {
    var items = results.filter(Boolean);
    if (!items.length) {
      G('tbTrack').innerHTML = '<span style="color:#484f58;font-size:.75rem;font-family:\'JetBrains Mono\',monospace">ì¢…ëª© ë°ì´í„° ë¡œë”© ì¤‘...</span>';
      return;
    }
    function mkItems() {
      return items.map(function(it) {
        var up = (it.pct || 0) >= 0;
        var ps = it.isKRW ? fmtNum(it.price, 0) + 'ì›' : '$' + fmtNum(it.price, 2);
        return '<span class="ti" data-c="' + it.t.c + '" data-n="' + it.t.n + '"><b>' + it.t.n + '</b>' + ps +
          '<span class="' + (up ? 'cu' : 'cd') + '">' + fmtPct(it.pct) + '</span></span>';
      }).join('');
    }
    var tr = G('tbTrack');
    tr.innerHTML = mkItems() + mkItems();
    tr.querySelectorAll('.ti').forEach(function(el) {
      el.addEventListener('click', function() {
        doSearch(el.getAttribute('data-c'), el.getAttribute('data-n'));
      });
    });
  });
}

// â”€â”€ ì´ë²¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
G('btn').addEventListener('click', searchFromInput);
G('q').addEventListener('keydown', function(e) {
  var items = G('sug').querySelectorAll('.sgr');
  if (e.key === 'ArrowDown') {
    e.preventDefault();
    sugIdx = Math.min(sugIdx + 1, items.length - 1);
    items.forEach(function(el, i) { el.classList.toggle('active', i === sugIdx); });
  } else if (e.key === 'ArrowUp') {
    e.preventDefault();
    sugIdx = Math.max(sugIdx - 1, -1);
    items.forEach(function(el, i) { el.classList.toggle('active', i === sugIdx); });
  } else if (e.key === 'Enter') {
    e.preventDefault();
    if (sugIdx >= 0 && items[sugIdx]) {
      items[sugIdx].click();
    } else {
      hideSug();
      searchFromInput();
    }
  } else if (e.key === 'Escape') {
    hideSug();
  }
});
G('q').addEventListener('input', function(e) {
  clearTimeout(sugTimer);
  sugTimer = setTimeout(function() { showSug(e.target.value); }, 220);
});
document.addEventListener('click', function(e) { if (!e.target.closest('.sw')) hideSug(); });
document.querySelectorAll('.chip').forEach(function(chip) {
  chip.addEventListener('click', function() {
    document.querySelectorAll('.chip').forEach(function(c) { c.classList.remove('on'); });
    chip.classList.add('on');
  });
});

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Worker í—¬ìŠ¤ ì²´í¬: ì¡°ìš©í•˜ê²Œ, ë°°ë„ˆëŠ” Worker ì‹¤ì œ ì—†ì„ ë•Œë§Œ
fetch('/api/health').then(function(r) {
  var ct = r.headers.get('content-type') || '';
  if (r.ok && ct.includes('json')) {
    markWorkerOK();
  } else {
    markWorkerFail();
  }
}).catch(function() {
  markWorkerFail();
});

loadTicker();
loadPop();

})();
</script>
</body>
</html>
