<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>KRX AI ë§¤ë§¤ ì „ëµ ë¶„ì„ê¸°</title>

<!-- Plotly -->
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#0e1117;
    color:white;
}

.wrapper{
    max-width:1200px;
    margin:auto;
    padding:40px 20px;
}

.controls{
    display:flex;
    gap:10px;
}

input,select{
    flex:1;
    padding:12px;
    border-radius:8px;
    border:none;
}

button{
    background:#16c784;
    color:white;
    border:none;
    padding:12px 18px;
    border-radius:8px;
    cursor:pointer;
}

.metrics{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:12px;
    margin-top:20px;
}

.card{
    background:#1b222c;
    padding:18px;
    border-radius:12px;
    text-align:center;
}

.card p{
    font-size:20px;
    font-weight:bold;
}

#chart{
    margin-top:25px;
    height:650px;
}
</style>
</head>

<body>

<div class="wrapper">

<h2>ğŸ“ˆ KRX AI ë§¤ë§¤ ì „ëµ ë¶„ì„ê¸°</h2>

<div class="controls">
<input id="search" placeholder="ì¢…ëª© ê²€ìƒ‰ (ì‚¼ì„±, sk, apple)">
<select id="stock"></select>
<button id="runBtn">ë¶„ì„ ì‹œì‘</button>
</div>

<div class="metrics">
<div class="card"><h4>í˜„ì¬ê°€</h4><p id="cur">-</p></div>
<div class="card"><h4>ë§¤ìˆ˜</h4><p id="buy">-</p></div>
<div class="card"><h4>ì†ì ˆ</h4><p id="stop">-</p></div>
<div class="card"><h4>ëª©í‘œ</h4><p id="target">-</p></div>
</div>

<div id="chart"></div>

</div>

<script>
////////////////////////////////////////////////////
// JS ì „ë¶€ HTML ì•ˆì— í¬í•¨ â†’ 100% ì‹¤í–‰ ë³´ì¥
////////////////////////////////////////////////////

const stocks = [
 {name:"ì‚¼ì„±ì „ì", ticker:"005930.KS"},
 {name:"SKí•˜ì´ë‹‰ìŠ¤", ticker:"000660.KS"},
 {name:"ë„¤ì´ë²„", ticker:"035420.KS"},
 {name:"ì¹´ì¹´ì˜¤", ticker:"035720.KS"},
 {name:"Apple", ticker:"AAPL"},
 {name:"Tesla", ticker:"TSLA"}
];

const select=document.getElementById("stock");
const search=document.getElementById("search");
const btn=document.getElementById("runBtn");

function populate(list){
 select.innerHTML="";
 list.forEach(s=>{
   const o=document.createElement("option");
   o.value=s.ticker;
   o.textContent=s.name+" ("+s.ticker+")";
   select.appendChild(o);
 });
}
populate(stocks);

search.addEventListener("input",()=>{
 const q=search.value.toLowerCase();
 populate(stocks.filter(s=>s.name.toLowerCase().includes(q)));
});

const mean=a=>a.reduce((x,y)=>x+y,0)/a.length;
const std=a=>{
 const m=mean(a);
 return Math.sqrt(mean(a.map(x=>(x-m)**2)));
};

async function run(){

 const ticker=select.value;

 const url=`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?range=2y&interval=1d`;

 const r=await fetch(url);
 const j=await r.json();

 const close=j.chart.result[0].indicators.quote[0].close.filter(x=>x);

 const current=close.at(-1);
 const ma20=mean(close.slice(-20));
 const ma60=mean(close.slice(-60));

 const returns=close.slice(1).map((p,i)=>(p-close[i])/close[i]);
 const vol=std(returns);

 const buy=ma20*0.98;
 const stop=buy*(1-vol*3);
 const target=buy*1.20;

 document.getElementById("cur").innerText=current.toFixed(0);
 document.getElementById("buy").innerText=buy.toFixed(0);
 document.getElementById("stop").innerText=stop.toFixed(0);
 document.getElementById("target").innerText=target.toFixed(0);

 Plotly.newPlot("chart",[
   {y:close,name:"Price"},
   {y:close.map((_,i)=>i<20?null:mean(close.slice(i-20,i))),name:"MA20"},
   {y:close.map((_,i)=>i<60?null:mean(close.slice(i-60,i))),name:"MA60"}
 ]);
}

btn.onclick=run;

document.addEventListener("keydown",e=>{
 if(e.key==="Enter") run();
});
</script>

</body>
</html>
