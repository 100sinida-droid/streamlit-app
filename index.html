<!DOCTYPE html>
<html lang="ko">
<head>  
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>StockMind AI â€” ì‹¤ì‹œê°„ ì£¼ì‹ ë¶„ì„</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+KR:wght@400;500;700&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7938956361770773"
     crossorigin="anonymous"></script>
  <meta name="google-adsense-account" content="ca-pub-7938956361770773">
    
<style>
:root{--bg:#07090d;--bg2:#0d1117;--bg3:#161b22;--brd:#21262d;--acc:#00d4aa;--ac3:#7c3aed;--tx:#e6edf3;--tx2:#8b949e;--tx3:#484f58;--up:#3fb950;--dn:#f85149;--r:12px}
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{scroll-behavior:smooth}
body{background:var(--bg);color:var(--tx);font-family:'Noto Sans KR',sans-serif;min-height:100vh;overflow-x:hidden}
header{position:sticky;top:0;z-index:100;background:rgba(7,9,13,.96);backdrop-filter:blur(16px);border-bottom:1px solid var(--brd);display:flex;align-items:center;padding:0 28px;height:56px;gap:20px}
.logo{font-family:'Bebas Neue',sans-serif;font-size:1.55rem;letter-spacing:2px;flex-shrink:0}.logo span{color:var(--acc)}
.tb{flex:1;overflow:hidden;position:relative}
.tb::before,.tb::after{content:'';position:absolute;top:0;bottom:0;width:48px;z-index:2;pointer-events:none}
.tb::before{left:0;background:linear-gradient(to right,#07090d,transparent)}
.tb::after{right:0;background:linear-gradient(to left,#07090d,transparent)}
.tb-track{display:flex;gap:32px;white-space:nowrap;animation:ticker 42s linear infinite}
.tb-track:hover{animation-play-state:paused}
@keyframes ticker{from{transform:translateX(0)}to{transform:translateX(-50%)}}
.ti{font-family:'JetBrains Mono',monospace;font-size:.75rem;color:var(--tx2);display:inline-flex;align-items:center;gap:7px;cursor:pointer;flex-shrink:0;transition:color .2s}
.ti:hover{color:var(--tx)}.ti b{color:var(--tx)}
.cu{color:var(--up)}.cd{color:var(--dn)}
main{max-width:1100px;margin:0 auto;padding:0 24px 80px;position:relative}
.hero{padding:70px 0 48px;text-align:center}
.hero-badge{display:inline-block;margin-bottom:22px;font-family:'JetBrains Mono',monospace;font-size:.7rem;letter-spacing:3px;text-transform:uppercase;color:var(--acc);border:1px solid rgba(0,212,170,.28);padding:4px 16px;border-radius:100px}
.hero h1{font-family:'Bebas Neue',sans-serif;font-size:clamp(2.8rem,8vw,5.2rem);line-height:1.06;letter-spacing:1px;margin-bottom:14px}
.hero h1 em{font-style:normal;color:var(--acc)}
.hero-sub{color:var(--tx2);font-size:.95rem;line-height:1.9;margin-bottom:38px}
.sw{position:relative;max-width:680px;margin:0 auto 20px}
.sb{display:flex;align-items:center;background:var(--bg3);border:1.5px solid var(--brd);border-radius:14px;padding:6px 6px 6px 18px;gap:10px;transition:border-color .25s,box-shadow .25s}
.sb:focus-within{border-color:var(--acc);box-shadow:0 0 0 3px rgba(0,212,170,.1),0 8px 28px rgba(0,0,0,.4)}
.si{width:20px;height:20px;color:var(--tx3);flex-shrink:0}
#q{flex:1;background:none;border:none;outline:none;color:var(--tx);font-family:'Noto Sans KR',sans-serif;font-size:1rem;padding:10px 0}
#q::placeholder{color:var(--tx3)}
#btn{background:var(--acc);color:var(--bg);border:none;border-radius:10px;padding:12px 24px;font-family:'Noto Sans KR',sans-serif;font-weight:700;font-size:.9rem;cursor:pointer;white-space:nowrap;transition:background .2s,transform .15s}
#btn:hover{background:#00bfa0;transform:translateY(-1px)}#btn:active{transform:none}#btn:disabled{opacity:.5;cursor:not-allowed;transform:none}
#sug{position:absolute;top:calc(100% + 6px);left:0;right:0;background:var(--bg3);border:1px solid var(--brd);border-radius:12px;overflow:hidden;z-index:60;display:none;box-shadow:0 16px 48px rgba(0,0,0,.6)}
#sug.open{display:block}
.sg{display:flex;justify-content:space-between;align-items:center;padding:10px 16px;cursor:pointer;border-bottom:1px solid var(--brd);transition:background .15s}
.sg:last-child{border-bottom:none}.sg:hover,.sg.active{background:rgba(255,255,255,.05)}
.sg-nm{font-size:.9rem;font-weight:500}.sg-sub{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--tx2);margin-top:2px}
.sg-badge{font-size:.64rem;padding:2px 8px;border-radius:100px;font-weight:700;flex-shrink:0}
.bk{background:rgba(124,58,237,.18);color:#a78bfa}.bq{background:rgba(0,212,170,.14);color:var(--acc)}.bu{background:rgba(255,107,53,.14);color:#ff6b35}
.sg-loading{padding:12px 16px;color:var(--tx3);font-size:.84rem;font-family:'JetBrains Mono',monospace}
.chips{display:flex;gap:8px;justify-content:center;flex-wrap:wrap}
.chip{background:var(--bg3);border:1px solid var(--brd);color:var(--tx2);border-radius:100px;padding:5px 16px;font-family:'JetBrains Mono',monospace;font-size:.76rem;cursor:pointer;transition:all .2s}
.chip:hover,.chip.on{background:var(--acc);color:var(--bg);border-color:var(--acc)}
#banner{display:none;margin-top:18px;border-radius:var(--r);padding:20px 24px;background:rgba(248,81,73,.07);border:1px solid rgba(248,81,73,.28)}
#banner h3{color:var(--dn);font-size:.9rem;margin-bottom:8px}
#banner p{color:var(--tx2);font-size:.84rem;line-height:1.9}
#banner code{color:var(--acc);font-family:'JetBrains Mono',monospace;background:rgba(0,212,170,.08);padding:1px 5px;border-radius:3px}
.rs{margin-top:16px;animation:fu .4s ease both}
@keyframes fu{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:none}}
.rh{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);padding:24px 28px;margin-bottom:14px;position:relative;overflow:hidden}
.rh::before{content:'';position:absolute;top:0;left:0;right:0;height:3px;background:linear-gradient(to right,var(--acc),var(--ac3))}
.rm{display:flex;gap:10px;align-items:center;margin-bottom:7px}
.rm-mkt{font-family:'JetBrains Mono',monospace;font-size:.68rem;padding:2px 9px;border-radius:100px;background:rgba(0,212,170,.13);color:var(--acc);font-weight:700}
.rm-t{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--tx3)}
.rn{display:flex;align-items:center;gap:10px;margin-bottom:12px;flex-wrap:wrap}
.rn h2{font-family:'Bebas Neue',sans-serif;font-size:2rem;letter-spacing:1px}
.rbdg{font-family:'JetBrains Mono',monospace;font-size:.78rem;color:var(--tx2);background:var(--bg3);border:1px solid var(--brd);padding:2px 10px;border-radius:7px}
.pb{display:flex;align-items:baseline;gap:12px;flex-wrap:wrap}
.pm{font-family:'JetBrains Mono',monospace;font-size:2.4rem;font-weight:700}
.pc{font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:700}
.pc.up{color:var(--up)}.pc.dn{color:var(--dn)}
.dg{display:grid;grid-template-columns:1fr 300px;gap:14px;margin-bottom:14px}
@media(max-width:760px){.dg{grid-template-columns:1fr}}
.cc,.sc{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);padding:20px}
.cl{font-family:'JetBrains Mono',monospace;font-size:.68rem;letter-spacing:2px;text-transform:uppercase;color:var(--tx3);margin-bottom:14px}
#mychart{width:100%!important;height:215px!important}
.sg2{display:grid;grid-template-columns:1fr 1fr;gap:8px}
.si2{background:var(--bg3);border-radius:8px;padding:11px}
.sl{font-family:'JetBrains Mono',monospace;font-size:.58rem;letter-spacing:1px;text-transform:uppercase;color:var(--tx3);margin-bottom:4px}
.sv{font-family:'JetBrains Mono',monospace;font-size:.88rem;font-weight:700}
.ap{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);padding:24px 28px;position:relative;overflow:hidden}
.ap::before{content:'';position:absolute;inset:0;pointer-events:none;background:radial-gradient(ellipse at top left,rgba(124,58,237,.06),transparent 55%)}
.ap-h{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
.ap-t{display:flex;align-items:center;gap:7px;font-weight:700;color:var(--acc);font-size:.95rem}
.ap-b{font-family:'JetBrains Mono',monospace;font-size:.64rem;color:var(--tx3);padding:2px 9px;border:1px solid var(--brd);border-radius:100px}
.al{display:flex;align-items:center;gap:12px;padding:22px 0;color:var(--tx2);font-size:.86rem}
.sp{width:30px;height:30px;flex-shrink:0;border:3px solid transparent;border-top-color:var(--acc);border-radius:50%;animation:spin .8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.as{margin-bottom:22px}.as:last-child{margin-bottom:0}
.ast{font-family:'JetBrains Mono',monospace;font-size:.67rem;letter-spacing:2px;text-transform:uppercase;color:var(--acc);margin-bottom:10px;padding-bottom:6px;border-bottom:1px solid rgba(0,212,170,.15)}
.vr{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
.vc{padding:6px 16px;border-radius:100px;font-weight:700;font-size:.83rem;font-family:'JetBrains Mono',monospace}
.vc.buy{background:rgba(63,185,80,.13);color:var(--up);border:1px solid rgba(63,185,80,.3)}
.vc.sell{background:rgba(248,81,73,.13);color:var(--dn);border:1px solid rgba(248,81,73,.3)}
.vc.hold{background:rgba(255,179,0,.13);color:#ffb300;border:1px solid rgba(255,179,0,.3)}
.vc.watch{background:rgba(124,58,237,.13);color:#a78bfa;border:1px solid rgba(124,58,237,.3)}
.vc.low{background:rgba(63,185,80,.1);color:var(--up);border:1px solid rgba(63,185,80,.2)}
.vc.mid{background:rgba(255,179,0,.1);color:#ffb300;border:1px solid rgba(255,179,0,.2)}
.vc.high{background:rgba(248,81,73,.1);color:var(--dn);border:1px solid rgba(248,81,73,.2)}
.ar{color:#c9d1d9;line-height:1.9;margin-top:10px;font-size:.9rem}
.str{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.sb2{flex:1;min-width:100px;background:var(--bg3);border-radius:9px;padding:12px;text-align:center}
.sbl{font-family:'JetBrains Mono',monospace;font-size:.58rem;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px}
.sbv{font-family:'JetBrains Mono',monospace;font-size:.88rem;font-weight:700;line-height:1.35}
.sb2.sbuy .sbv{color:var(--up)}.sb2.ssell .sbv{color:var(--dn)}.sb2.sstop .sbv{color:#ff6b35}.sb2.smid .sbv{color:var(--acc)}
.sub{color:var(--tx2);font-size:.82rem;margin-top:5px;line-height:1.7}
.scr{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
.scb{flex:1;min-width:130px;background:var(--bg3);border-radius:9px;padding:12px}
.scl{font-family:'JetBrains Mono',monospace;font-size:.6rem;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px}
.scp{font-family:'JetBrains Mono',monospace;font-size:1rem;font-weight:700;margin-bottom:4px}
.scb.bull .scp{color:var(--up)}.scb.base .scp{color:var(--acc)}.scb.bear .scp{color:var(--dn)}
.scd{color:var(--tx2);font-size:.78rem;line-height:1.6}
.rbr{display:flex;align-items:center;gap:10px;margin:10px 0}
.rbl{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--tx2);width:50px}
.rbt{flex:1;height:7px;background:var(--bg3);border-radius:100px;overflow:hidden}
.rbf{height:100%;border-radius:100px;transition:width 1.2s ease}
.rbf.low{background:var(--up)}.rbf.mid{background:#ffb300}.rbf.high{background:var(--dn)}
.rbp{font-family:'JetBrains Mono',monospace;font-size:.68rem;color:var(--tx2);width:30px;text-align:right}
.rl{list-style:none;margin-top:10px}
.rl li{display:flex;gap:8px;align-items:flex-start;padding:5px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.85rem;color:var(--tx2);line-height:1.65}
.rl li:last-child{border-bottom:none}.rl li::before{content:'â–¸';color:var(--dn);flex-shrink:0;margin-top:2px}
.wl{list-style:none;margin-top:8px;counter-reset:wc}
.wl li{counter-increment:wc;display:flex;gap:10px;align-items:flex-start;padding:6px 0;border-bottom:1px solid rgba(255,255,255,.04);font-size:.85rem;color:#c9d1d9;line-height:1.65}
.wl li:last-child{border-bottom:none}
.wl li::before{content:counter(wc);font-family:'JetBrains Mono',monospace;font-size:.7rem;font-weight:700;color:var(--acc);background:rgba(0,212,170,.1);min-width:20px;height:20px;border-radius:50%;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;margin-top:2px}
.ps{margin-top:52px}
.ps-l{font-family:'JetBrains Mono',monospace;font-size:.68rem;letter-spacing:3px;text-transform:uppercase;color:var(--tx3);margin-bottom:14px}
.pg{display:grid;grid-template-columns:repeat(auto-fill,minmax(188px,1fr));gap:11px}
.pc2{background:var(--bg2);border:1px solid var(--brd);border-radius:var(--r);padding:16px;cursor:pointer;transition:border-color .2s,transform .2s,box-shadow .2s;position:relative;overflow:hidden}
.pc2::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:linear-gradient(to right,var(--acc),var(--ac3));transform:scaleX(0);transition:transform .3s}
.pc2:hover{border-color:rgba(0,212,170,.45);transform:translateY(-3px);box-shadow:0 10px 26px rgba(0,0,0,.4)}.pc2:hover::after{transform:scaleX(1)}
.psm{font-family:'JetBrains Mono',monospace;font-size:.65rem;color:var(--tx3);margin-bottom:3px}
.pn{font-weight:700;font-size:.88rem;margin-bottom:10px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.pp{font-family:'JetBrains Mono',monospace;font-size:1.02rem;font-weight:700;margin-bottom:2px}
.pch{font-family:'JetBrains Mono',monospace;font-size:.74rem;font-weight:700}
.pch.up{color:var(--up)}.pch.dn{color:var(--dn)}.pch.na{color:var(--tx3)}
.sk{height:112px;border-radius:var(--r);border:1px solid var(--brd);background:linear-gradient(90deg,var(--bg2) 0%,var(--bg3) 50%,var(--bg2) 100%);background-size:200% 100%;animation:sk 1.4s infinite}
@keyframes sk{to{background-position:-200% 0}}
footer{text-align:center;padding:24px;border-top:1px solid var(--brd);color:var(--tx3);font-size:.74rem;line-height:2}
footer .mn{font-family:'JetBrains Mono',monospace;font-size:.65rem}
.toast{position:fixed;bottom:24px;left:50%;transform:translateX(-50%);background:#0d1117;border:1px solid var(--dn);color:var(--dn);padding:10px 22px;border-radius:11px;font-size:.84rem;z-index:9999;box-shadow:0 8px 28px rgba(0,0,0,.6);max-width:88vw;text-align:center;line-height:1.5;animation:fu .3s ease}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:var(--bg)}::-webkit-scrollbar-thumb{background:var(--brd);border-radius:2px}
@media(max-width:560px){header{padding:0 12px}main{padding:0 12px 56px}.hero{padding:38px 0 30px}.rh,.ap{padding:14px}.pm{font-size:1.9rem}#btn{padding:12px 14px;font-size:.84rem}}
</style>
</head>
<body> 
<header>
  <div class="logo">STOCK<span>MIND</span></div>
  <div class="tb"><div class="tb-track" id="tbTrack"><span style="color:#484f58;font-family:'JetBrains Mono',monospace;font-size:.75rem">ë°ì´í„° ë¡œë”© ì¤‘...</span></div></div>
</header>
<main>
  <section class="hero">
    <div class="hero-badge">AI ì£¼ì‹ ë¶„ì„ í”Œë«í¼</div>
    <h1>ì£¼ì‹ì„ ê²€ìƒ‰í•˜ê³ <br><em>AIì˜ ëˆˆ</em>ìœ¼ë¡œ ë³´ë¼</h1>
    <p class="hero-sub">ì½”ìŠ¤í”¼ Â· ì½”ìŠ¤ë‹¥ Â· ë¯¸êµ­ ì£¼ì‹ ì‹¤ì‹œê°„ ë¶„ì„<br>ì–¸ì œ ì‚¬ê³  íŒ”ì§€, AIê°€ êµ¬ì²´ì ìœ¼ë¡œ ì•Œë ¤ë“œë¦½ë‹ˆë‹¤</p>
    <div class="sw">
      <div class="sb">
        <svg class="si" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.35-4.35"></path></svg>
        <input id="q" type="text" placeholder="ì¢…ëª©ëª…, ì½”ë“œ ê²€ìƒ‰ (ì‚¼ì„±ì „ì, ì´ê±´í™€ë”©ìŠ¤, ì—ì½”í”„ë¡œ, AAPL...)" autocomplete="off" spellcheck="false">
        <button id="btn">ë¶„ì„í•˜ê¸°</button>
      </div>
      <div id="sug"></div>
    </div>
    <div class="chips">
      <button class="chip on">ì „ì²´</button>
      <button class="chip">KOSPI</button>
      <button class="chip">KOSDAQ</button>
      <button class="chip">ë¯¸êµ­</button>
    </div>
  </section>

<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7938956361770773"
     crossorigin="anonymous"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-format="autorelaxed"
     data-ad-client="ca-pub-7938956361770773"
     data-ad-slot="5368010468"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
  
  <div id="banner"></div>
  <section id="rs" style="display:none">
    <div class="rh">
      <div class="rm"><span class="rm-mkt" id="rMkt"></span><span class="rm-t" id="rTime"></span></div>
      <div class="rn"><h2 id="rName"></h2><span class="rbdg" id="rTick"></span></div>
      <div class="pb"><span class="pm" id="rPr"></span><span class="pc" id="rCh"></span></div>
    </div>
    <div class="dg">
      <div class="cc"><div class="cl">ê°€ê²© ì°¨íŠ¸ (ìµœê·¼ 30ì¼)</div><canvas id="mychart"></canvas></div>
      <div class="sc"><div class="cl">í•µì‹¬ ì§€í‘œ</div><div class="sg2" id="statsGrid"></div></div>
    </div>
    <div class="ap">
      <div class="ap-h">
        <div class="ap-t"><svg viewBox="0 0 24 24" fill="currentColor" width="16" height="16"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"></path></svg>AI ë¶„ì„ ë¦¬í¬íŠ¸</div>
        <span class="ap-b">Claude AI</span>
      </div>
      <div class="al" id="aiLoad"><div class="sp"></div><span>ë°ì´í„° ë¶„ì„ ì¤‘...</span></div>
      <div id="aiCont" style="display:none"></div>
    </div>
  </section>
  <section class="ps">
    <div class="ps-l">ì¸ê¸° ì¢…ëª©</div>
    <div class="pg" id="popGrid"><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div><div class="sk"></div></div>
  </section>
</main>
<footer>
  <p>StockMind AI Â· íˆ¬ìëŠ” ë³¸ì¸ ì±…ì„ì…ë‹ˆë‹¤ Â· ì •ë³´ ì œê³µ ëª©ì ì´ë©° íˆ¬ì ê¶Œìœ ê°€ ì•„ë‹™ë‹ˆë‹¤</p>
  <p class="mn">Naver Finance Â· Yahoo Finance Â· Claude AI Â· Cloudflare Pages</p>
</footer>
<script>
(function(){
'use strict';

// â”€â”€ ë¯¸êµ­ ì£¼ì‹ ë¡œì»¬ DB (ìë™ì™„ì„±ìš©) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var US_DB=[
  {c:'AAPL',m:'NASDAQ',n:'Apple',e:'Apple Inc'},
  {c:'MSFT',m:'NASDAQ',n:'Microsoft',e:'Microsoft Corp'},
  {c:'GOOGL',m:'NASDAQ',n:'Alphabet',e:'Alphabet Inc'},
  {c:'AMZN',m:'NASDAQ',n:'Amazon',e:'Amazon.com'},
  {c:'NVDA',m:'NASDAQ',n:'NVIDIA',e:'NVIDIA Corp'},
  {c:'META',m:'NASDAQ',n:'Meta',e:'Meta Platforms'},
  {c:'TSLA',m:'NASDAQ',n:'Tesla',e:'Tesla Inc'},
  {c:'TSM',m:'NYSE',n:'TSMC',e:'Taiwan Semiconductor'},
  {c:'AVGO',m:'NASDAQ',n:'Broadcom',e:'Broadcom Inc'},
  {c:'NFLX',m:'NASDAQ',n:'Netflix',e:'Netflix Inc'},
  {c:'AMD',m:'NASDAQ',n:'AMD',e:'Advanced Micro Devices'},
  {c:'INTC',m:'NASDAQ',n:'Intel',e:'Intel Corp'},
  {c:'DIS',m:'NYSE',n:'Disney',e:'Walt Disney'},
  {c:'JPM',m:'NYSE',n:'JP Morgan',e:'JPMorgan Chase'},
  {c:'V',m:'NYSE',n:'Visa',e:'Visa Inc'},
  {c:'WMT',m:'NYSE',n:'Walmart',e:'Walmart Inc'},
  {c:'PLTR',m:'NASDAQ',n:'Palantir',e:'Palantir Technologies'},
  {c:'COIN',m:'NASDAQ',n:'Coinbase',e:'Coinbase Global'},
  {c:'ARM',m:'NASDAQ',n:'Arm Holdings',e:'Arm Holdings'},
  {c:'UBER',m:'NYSE',n:'Uber',e:'Uber Technologies'},
  {c:'ORCL',m:'NYSE',n:'Oracle',e:'Oracle Corp'},
  {c:'SMCI',m:'NASDAQ',n:'Super Micro',e:'Super Micro Computer'}
];

// í•œêµ­ ì£¼ì‹ ìì£¼ ì“°ëŠ” ë³„ì¹­ â†’ ì¢…ëª©ì½”ë“œ
var AL={
  'ì‚¼ì„±':'005930','ì‚¼ì„±ì „ì':'005930','í•˜ì´ë‹‰ìŠ¤':'000660','skí•˜ì´ë‹‰ìŠ¤':'000660',
  'ë„¤ì´ë²„':'035420','ì¹´ì¹´ì˜¤':'035720','í˜„ëŒ€ì°¨':'005380','í˜„ëŒ€ìë™ì°¨':'005380',
  'ê¸°ì•„':'000270','ê¸°ì•„ì°¨':'000270','ì…€íŠ¸ë¦¬ì˜¨':'068270','ì¹´ì¹´ì˜¤ë±…í¬':'323410',
  'í¬ë˜í”„í†¤':'259960','í•˜ì´ë¸Œ':'352820','ì—”ì”¨':'036570','ì—”ì”¨ì†Œí”„íŠ¸':'036570',
  'ë„·ë§ˆë¸”':'251270','kt':'030200','skt':'017670','skí…”ë ˆì½¤':'017670',
  'lgì „ì':'066570','lg':'003550','ì‚¼ì„±sdi':'006400','sdi':'006400',
  'ì‹ í•œ':'055550','kb':'105560','kbê¸ˆìœµ':'105560','í•œì „':'015760',
  'í•œêµ­ì „ë ¥':'015760','ì´ê±´í™€ë”©ìŠ¤':'015360','ì—ì½”í”„ë¡œë¹„ì— ':'247540','ì—ì½”í”„ë¡œ':'086520',
  'í¬ìŠ¤ì½”':'005490','posco':'005490','ë‘ì‚°':'034020','ì•„ëª¨ë ˆ':'090430',
  'ë„¥ìŠ¨':'ë„¥ìŠ¨','í„ì–´ë¹„ìŠ¤':'263750','ì—ìŠ¤ì— ':'041510','jyp':'035900'
};

// ë¯¸êµ­ ë³„ì¹­
var US_AL={
  'nvidia':'NVDA','ì—”ë¹„ë””ì•„':'NVDA','tesla':'TSLA','í…ŒìŠ¬ë¼':'TSLA',
  'apple':'AAPL','ì• í”Œ':'AAPL','microsoft':'MSFT','ë§ˆì´í¬ë¡œì†Œí”„íŠ¸':'MSFT',
  'google':'GOOGL','êµ¬ê¸€':'GOOGL','amazon':'AMZN','ì•„ë§ˆì¡´':'AMZN',
  'meta':'META','ë©”íƒ€':'META','netflix':'NFLX','ë„·í”Œë¦­ìŠ¤':'NFLX',
  'intel':'INTC','ì¸í…”':'INTC','disney':'DIS','ë””ì¦ˆë‹ˆ':'DIS',
  'palantir':'PLTR','íŒ”ë€í‹°ì–´':'PLTR','broadcom':'AVGO'
};

function G(id){return document.getElementById(id);}
function isKR(s){return s.slice(-3)==='.KS'||s.slice(-3)==='.KQ';}
function fN(v,d){var n=parseFloat(String(v||0).replace(/,/g,''));if(!isFinite(n)||n===0)return 'N/A';return n.toLocaleString('ko-KR',{maximumFractionDigits:d===undefined?2:d});}
function fP(v,kr){var n=parseFloat(String(v||0).replace(/,/g,''));if(!isFinite(n)||n===0)return 'N/A';return kr?fN(n,0)+'ì›':'$'+fN(n,n>=100?2:4);}
function fPct(v){var n=parseFloat(v||0);return !isFinite(n)?'':(n>=0?'+':'')+n.toFixed(2)+'%';}
function fCap(v,kr){if(!v||v<=0)return 'N/A';return kr?(v>=1e12?fN(v/1e12,1)+'ì¡°ì›':fN(v/1e8,0)+'ì–µì›'):'$'+fN(v/1e9,1)+'B';}

// API í˜¸ì¶œ
function apiStock(p){
  var qs=Object.keys(p).map(function(k){return encodeURIComponent(k)+'='+encodeURIComponent(p[k]);}).join('&');
  return fetch('/api/stock?'+qs).then(function(r){
    var ct=r.headers.get('content-type')||'';
    if(!ct.includes('json')){showBanner();throw new Error('Worker ì—†ìŒ');}
    return r.json();
  }).then(function(j){if(!j.ok)throw new Error(j.error||'ì˜¤ë¥˜');return j;});
}

function showBanner(){
  var b=G('banner');
  b.innerHTML='<h3>âš  _worker.js ë¯¸ì‘ë‹µ</h3><p>GitHub ë£¨íŠ¸ì— <code>_worker.js</code> íŒŒì¼ì„ ì˜¬ë ¤ì£¼ì„¸ìš”. <a href="/api/health" target="_blank" style="color:var(--acc)">â†’ /api/health í™•ì¸</a></p>';
  b.style.display='block';
}

// â”€â”€ ìë™ì™„ì„±: ë„¤ì´ë²„ ì‹¤ì‹œê°„ ê²€ìƒ‰ + ë¯¸êµ­ ë¡œì»¬ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var sugT=null;
var sugIdx=-1;

function searchUS(q){
  var lq=q.toLowerCase().replace(/\s+/g,'');
  var a=US_AL[lq];
  if(a){var f=US_DB.find(function(d){return d.c===a;});if(f)return[f];}
  var hits=[];
  for(var i=0;i<US_DB.length&&hits.length<4;i++){
    var d=US_DB[i];
    if(d.n.toLowerCase().indexOf(lq)>=0||d.e.toLowerCase().indexOf(lq)>=0||d.c.toLowerCase().indexOf(lq)>=0)hits.push(d);
  }
  return hits;
}

function showSug(query){
  var q=query.trim();
  if(!q){hideSug();return;}
  var lq=q.toLowerCase().replace(/\s+/g,'');
  sugIdx=-1;

  // ë¯¸êµ­ ì£¼ì‹ ë¡œì»¬ ê²€ìƒ‰
  var usHits=searchUS(lq);

  // 6ìë¦¬ ìˆ«ì ì§ì ‘ ì…ë ¥
  if(/^\d{6}$/.test(q)){
    G('sug').innerHTML='<div class="sg" data-sym="'+q+'.KS" data-name="'+q+'" data-mkt="KOSPI"><div><div class="sg-nm">'+q+' <span style="color:#484f58;font-size:.72rem">(ì½”ë“œ ì§ì ‘ ì…ë ¥)</span></div><div class="sg-sub">'+q+'.KS Â· KOSPI</div></div><span class="sg-badge bk">KOSPI</span></div>';
    G('sug').classList.add('open');
    bindSugClicks();
    return;
  }

  // í•œêµ­ ë³„ì¹­ ë§¤í•‘ í™•ì¸
  var krCode=AL[lq];
  if(krCode){
    G('sug').innerHTML='<div class="sg-loading">ê²€ìƒ‰ ì¤‘...</div>';
    G('sug').classList.add('open');
    fetch('/api/search?q='+encodeURIComponent(krCode)).then(function(r){return r.json();}).then(function(d){
      renderSugResults(d.results||[], usHits);
    }).catch(function(){hideSug();});
    return;
  }

  // ì˜ë¬¸ í‹°ì»¤ ì§ì ‘ ë§¤ì¹­ (ë¯¸êµ­)
  var uMatch=US_DB.find(function(d){return d.c===q.toUpperCase();});
  if(uMatch){
    renderSugResults([], [uMatch]);
    return;
  }

  // 2ê¸€ì ì´ìƒì´ë©´ ë„¤ì´ë²„ API ê²€ìƒ‰
  if(q.length>=2){
    G('sug').innerHTML='<div class="sg-loading">ê²€ìƒ‰ ì¤‘...</div>';
    G('sug').classList.add('open');
    fetch('/api/search?q='+encodeURIComponent(q)).then(function(r){
      var ct=r.headers.get('content-type')||'';
      if(!ct.includes('json'))return{results:[]};
      return r.json();
    }).then(function(d){
      renderSugResults(d.results||[], usHits);
    }).catch(function(){
      // API ì‹¤íŒ¨ ì‹œ ë¯¸êµ­ ë¡œì»¬ë§Œ
      if(usHits.length>0)renderSugResults([],usHits);
      else hideSug();
    });
  } else if(usHits.length>0){
    renderSugResults([],usHits);
  } else {
    hideSug();
  }
}

function renderSugResults(krList, usList){
  var items=[];
  // í•œêµ­ ê²°ê³¼
  for(var i=0;i<krList.length&&items.length<6;i++){
    var d=krList[i];
    items.push({sym:d.symbol,name:d.name,code:d.code,mkt:d.market});
  }
  // ë¯¸êµ­ ê²°ê³¼
  for(var j=0;j<usList.length&&items.length<8;j++){
    var u=usList[j];
    items.push({sym:u.c,name:u.n,code:u.c,mkt:u.m,en:u.e});
  }
  if(!items.length){hideSug();return;}
  var mc={KOSPI:'bk',KOSDAQ:'bq',NASDAQ:'bu',NYSE:'bu',KONEX:'bq'};
  G('sug').innerHTML=items.map(function(d){
    var sub=d.en?d.sym+' Â· '+d.mkt:d.code+' Â· '+d.mkt;
    var nm=d.en?d.name+' <span style="color:#484f58;font-size:.72rem">'+d.en+'</span>':d.name;
    return '<div class="sg" data-sym="'+d.sym+'" data-name="'+d.name+'" data-mkt="'+d.mkt+'"><div><div class="sg-nm">'+nm+'</div><div class="sg-sub">'+sub+'</div></div><span class="sg-badge '+(mc[d.mkt]||'bu')+'">'+d.mkt+'</span></div>';
  }).join('');
  G('sug').classList.add('open');
  bindSugClicks();
}

function bindSugClicks(){
  var items=G('sug').querySelectorAll('.sg');
  for(var j=0;j<items.length;j++){
    (function(el){
      el.addEventListener('click',function(){
        var sym=el.getAttribute('data-sym');
        var name=el.getAttribute('data-name');
        G('q').value=name;
        hideSug();
        doSearch(sym);
      });
    })(items[j]);
  }
}

function hideSug(){G('sug').classList.remove('open');sugIdx=-1;}

// â”€â”€ ì°¨íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var CI=null;
function drawChart(hist,kr){
  var labels=hist.map(function(h){var p=h.date.split('-');return p.length===3?(+p[1]+'/'+ +p[2]):h.date;});
  var prices=hist.map(function(h){return h.close;}).filter(function(v){return v>0;});
  if(!prices.length)return;
  var ctx=G('mychart').getContext('2d');
  if(CI)CI.destroy();
  var up=prices[prices.length-1]>=prices[0],col=up?'#3fb950':'#f85149';
  CI=new Chart(ctx,{type:'line',data:{labels:labels,datasets:[{data:prices,borderColor:col,borderWidth:2.5,pointRadius:0,pointHoverRadius:5,pointHoverBackgroundColor:col,fill:true,tension:0.36,
    backgroundColor:function(c){var g=c.chart.ctx.createLinearGradient(0,0,0,225);g.addColorStop(0,up?'rgba(63,185,80,.25)':'rgba(248,81,73,.25)');g.addColorStop(1,'rgba(0,0,0,0)');return g;}}]},
    options:{responsive:true,maintainAspectRatio:false,interaction:{mode:'index',intersect:false},
      plugins:{legend:{display:false},tooltip:{backgroundColor:'#0d1117',borderColor:'#21262d',borderWidth:1,titleColor:'#8b949e',bodyColor:'#e6edf3',bodyFont:{family:'JetBrains Mono',size:11},padding:10,
        callbacks:{label:function(c){return ' '+(kr?fN(c.parsed.y,0)+'ì›':'$'+fN(c.parsed.y,2));}}}},
      scales:{x:{grid:{color:'rgba(33,38,45,.7)'},ticks:{color:'#484f58',maxTicksLimit:8,font:{family:'JetBrains Mono',size:11}}},
              y:{grid:{color:'rgba(33,38,45,.7)'},ticks:{color:'#484f58',font:{family:'JetBrains Mono',size:11},callback:function(v){return kr?fN(v,0):'$'+fN(v,0);}}}}}});
}

// â”€â”€ AI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildPrompt(sd){
  var vals=sd.prices.filter(function(v){return v>0;});
  var mx=vals.length?Math.max.apply(null,vals):0,mn=vals.length?Math.min.apply(null,vals):0;
  var vol=mn>0?(((mx-mn)/mn)*100).toFixed(1):0;
  var trend=vals.length>=2?(vals[vals.length-1]>vals[0]?'ìƒìŠ¹':'í•˜ë½'):'ë³´í•©';
  var rec=vals.slice(-10).map(function(v,i){return 'D'+(i+1)+':'+Number(v).toFixed(2);}).join(', ');
  return 'ë‹¹ì‹ ì€ ì„¸ê³„ ìµœê³ ì˜ ì£¼ì‹ ì• ë„ë¦¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤. ì•„ë˜ ë°ì´í„°ë¥¼ ë¶„ì„í•´ ë°˜ë“œì‹œ ìˆœìˆ˜ JSONë§Œ ì¶œë ¥í•˜ì„¸ìš”.\n\n'+
    'ì¢…ëª©: '+sd.name+' ('+sd.sym+') | ì‹œì¥: '+sd.mkt+' | í˜„ì¬ê°€: '+sd.priceRaw+' | ë“±ë½: '+sd.chgPct+'%\n'+
    '52ì£¼ê³ ê°€: '+sd.h52+' | 52ì£¼ì €ê°€: '+sd.l52+' | ê±°ë˜ëŸ‰: '+sd.vol+' | ì‹œê°€ì´ì•¡: '+sd.mktcap+' | PER: '+sd.per+'\n'+
    'ìµœê·¼10ì¼: '+rec+' | íŠ¸ë Œë“œ: '+trend+' | ë³€ë™ì„±: '+vol+'%\n\n'+
    'JSON:{"verdict":"ë§¤ìˆ˜|ë§¤ë„|ê´€ë§|ì£¼ëª©","verdictReason":"3~4ë¬¸ì¥","buyStrategy":{"zone":"êµ¬ê°„","timing":"íƒ€ì´ë°","split":["1ì°¨","2ì°¨"]},"sellStrategy":{"shortTarget":"ë‹¨ê¸°","midTarget":"ì¤‘ê¸°","stopLoss":"ì†ì ˆ","exitSignal":"ì‹ í˜¸"},"risks":["ë¦¬1","ë¦¬2","ë¦¬3"],"riskLevel":"ë‚®ìŒ|ì¤‘ê°„|ë†’ìŒ","riskScore":45,"scenarios":{"bull":{"price":"ë‚™ê´€ê°€","desc":"ì„¤ëª…"},"base":{"price":"ê¸°ë³¸ê°€","desc":"ì„¤ëª…"},"bear":{"price":"ë¹„ê´€ê°€","desc":"ì„¤ëª…"}},"watchPoints":["í¬1","í¬2","í¬3","í¬4"],"summary":"2ë¬¸ì¥"}';
}
function callAI(sd){
  return fetch('/api/analyze',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({prompt:buildPrompt(sd)})})
    .then(function(r){var ct=r.headers.get('content-type')||'';if(!ct.includes('json'))throw new Error('AI ë¯¸ì‘ë‹µ');return r.json();});
}
function renderAI(r){
  if(!r||!r.verdict)return;
  var vcM={'ë§¤ìˆ˜':'buy','ë§¤ë„':'sell','ê´€ë§':'hold','ì£¼ëª©':'watch'};
  var vc=vcM[r.verdict]||'hold';
  var sc=Math.min(100,Math.max(0,r.riskScore||50));
  var rc=sc<38?'low':sc<63?'mid':'high';
  var bs=r.buyStrategy||{};var ss=r.sellStrategy||{};
  var scen=r.scenarios||{};var bull=scen.bull||{};var base=scen.base||{};var bear=scen.bear||{};
  var sp=(bs.split&&bs.split.length)?'<p class="sub">ë¶„í• ë§¤ìˆ˜: '+bs.split.join(' â†’ ')+'</p>':'';
  var tm=bs.timing?'<p class="sub">íƒ€ì´ë°: '+bs.timing+'</p>':'';
  var ex=ss.exitSignal?'<p class="sub">ìµì ˆ ì‹ í˜¸: '+ss.exitSignal+'</p>':'';
  var ri=(r.risks||[]).map(function(x){return '<li>'+x+'</li>';}).join('');
  var wp=(r.watchPoints||[]).map(function(x){return '<li>'+x+'</li>';}).join('');
  G('aiCont').innerHTML=
    '<div class="as"><div class="ast">ì¢…í•© íˆ¬ì ì˜ê²¬</div>'+
      '<div class="vr"><span class="vc '+vc+'">'+(r.verdict||'ê´€ë§')+'</span><span class="vc '+rc+'">ë¦¬ìŠ¤í¬ '+(r.riskLevel||'ì¤‘ê°„')+'</span></div>'+
      '<p class="ar">'+(r.verdictReason||r.summary||'')+'</p></div>'+
    '<div class="as"><div class="ast">ë§¤ìˆ˜ Â· ë§¤ë„ ì „ëµ</div>'+
      '<div class="str">'+
        '<div class="sb2 sbuy"><div class="sbl">ë§¤ìˆ˜ êµ¬ê°„</div><div class="sbv">'+(bs.zone||'N/A')+'</div></div>'+
        '<div class="sb2 ssell"><div class="sbl">ë‹¨ê¸° ëª©í‘œê°€</div><div class="sbv">'+(ss.shortTarget||'N/A')+'</div></div>'+
        '<div class="sb2 smid"><div class="sbl">ì¤‘ê¸° ëª©í‘œê°€</div><div class="sbv">'+(ss.midTarget||'N/A')+'</div></div>'+
        '<div class="sb2 sstop"><div class="sbl">ì†ì ˆê°€</div><div class="sbv">'+(ss.stopLoss||'N/A')+'</div></div>'+
      '</div>'+sp+tm+ex+'</div>'+
    '<div class="as"><div class="ast">3ê°œì›” ì‹œë‚˜ë¦¬ì˜¤</div>'+
      '<div class="scr">'+
        '<div class="scb bull"><div class="scl">ğŸŸ¢ ë‚™ê´€</div><div class="scp">'+(bull.price||'N/A')+'</div><div class="scd">'+(bull.desc||'-')+'</div></div>'+
        '<div class="scb base"><div class="scl">ğŸ”µ ê¸°ë³¸</div><div class="scp">'+(base.price||'N/A')+'</div><div class="scd">'+(base.desc||'-')+'</div></div>'+
        '<div class="scb bear"><div class="scl">ğŸ”´ ë¹„ê´€</div><div class="scp">'+(bear.price||'N/A')+'</div><div class="scd">'+(bear.desc||'-')+'</div></div>'+
      '</div></div>'+
    '<div class="as"><div class="ast">ë¦¬ìŠ¤í¬ ë¶„ì„</div>'+
      '<div class="rbr"><span class="rbl">ë¦¬ìŠ¤í¬</span><div class="rbt"><div class="rbf '+rc+'" id="rBar" style="width:0%"></div></div><span class="rbp">'+sc+'%</span></div>'+
      '<ul class="rl">'+ri+'</ul></div>'+
    '<div class="as"><div class="ast">í•µì‹¬ ê´€ì „ í¬ì¸íŠ¸</div><ul class="wl">'+wp+'</ul></div>';
  G('aiCont').style.display='block';G('aiLoad').style.display='none';
  setTimeout(function(){var b=G('rBar');if(b)b.style.width=sc+'%';},120);
}

// â”€â”€ í† ìŠ¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toast(msg){
  var o=document.querySelectorAll('.toast');for(var i=0;i<o.length;i++)o[i].remove();
  var el=document.createElement('div');el.className='toast';el.textContent='âš  '+msg;
  document.body.appendChild(el);setTimeout(function(){if(el.parentNode)el.remove();},7000);
}

// â”€â”€ ë©”ì¸ ê²€ìƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function doSearch(sym){
  if(!sym)return;
  var symbol=sym.trim().toUpperCase();
  // 6ìë¦¬ ìˆ«ìë©´ .KS ì¶”ê°€
  if(/^\d{6}$/.test(symbol))symbol=symbol+'.KS';

  G('rs').style.display='none';
  G('btn').disabled=true;G('btn').textContent='ë¡œë”© ì¤‘...';
  var kr=isKR(symbol);
  var mkt=kr?(symbol.endsWith('.KQ')?'KOSDAQ':'KOSPI'):'US MARKET';
  G('btn').textContent='ë°ì´í„° ìˆ˜ì§‘ ì¤‘...';

  Promise.all([apiStock({action:'quote',symbol:symbol}),apiStock({action:'chart',symbol:symbol,days:30})])
  .then(function(results){
    var qd=results[0];var hd=results[1];
    var hist=hd.history||[];
    var prices=hist.map(function(h){return h.close;}).filter(function(v){return v>0;});
    var p=qd.price||0;var chg=qd.change||0;var pct=qd.changePct||0;var up=chg>=0;
    // ì¢…ëª©ëª…ì´ ì˜ë¬¸ ì´ìƒí•œ ê²½ìš° ê²€ìƒ‰ì–´ ìš°ì„ 
    var displayName=qd.name||symbol;
    var ps=fP(p,kr);
    var cs=(up?'+':'')+(kr?fN(chg,0)+'ì›':(chg>=0?'+$':'-$')+fN(Math.abs(chg),2))+' ('+fPct(pct)+')';
    var sd={sym:symbol,mkt:qd.exchange||mkt,name:displayName,priceRaw:p,chgPct:pct,
            h52:fP(qd.high52,kr),l52:fP(qd.low52,kr),vol:fN(qd.volume,0),
            mktcap:fCap(qd.marketCap,kr),per:fN(qd.per,1),prices:prices};
    G('rMkt').textContent=qd.exchange||mkt;
    G('rTime').textContent='ì‹¤ì‹œê°„ Â· '+new Date().toLocaleTimeString('ko-KR');
    G('rName').textContent=displayName;G('rTick').textContent=symbol;
    G('rPr').textContent=ps;G('rCh').textContent=cs;
    G('rCh').className='pc '+(up?'up':'dn');
    G('statsGrid').innerHTML=[
      {l:'52ì£¼ ê³ ê°€',v:sd.h52},{l:'52ì£¼ ì €ê°€',v:sd.l52},
      {l:'ê±°ë˜ëŸ‰',v:sd.vol},{l:'ì‹œê°€ì´ì•¡',v:sd.mktcap},
      {l:'PER',v:sd.per},{l:'ë“±ë½ë¥ ',v:fPct(pct)}
    ].map(function(x){return '<div class="si2"><div class="sl">'+x.l+'</div><div class="sv">'+x.v+'</div></div>';}).join('');
    if(hist.length)drawChart(hist,kr);
    G('rs').style.display='block';G('rs').scrollIntoView({behavior:'smooth',block:'start'});
    G('aiLoad').style.display='flex';G('aiCont').style.display='none';G('btn').textContent='AI ë¶„ì„ ì¤‘...';
    callAI(sd).then(function(r){renderAI(r);}).catch(function(e){
      G('aiLoad').style.display='none';
      G('aiCont').innerHTML='<p style="color:#f85149;font-weight:700;margin-bottom:6px">âš  AI ì˜¤ë¥˜</p><p style="color:#8b949e;font-size:.84rem">'+e.message+'</p>';
      G('aiCont').style.display='block';
    });
  }).catch(function(e){console.error(e);toast(e.message);})
  .finally(function(){G('btn').disabled=false;G('btn').textContent='ë¶„ì„í•˜ê¸°';});
}

// ê²€ìƒ‰ì°½ì—ì„œ ì—”í„°/ë²„íŠ¼ â†’ ì§ì ‘ ì‹¬ë³¼ë¡œ ê²€ìƒ‰
function searchFromInput(){
  var v=G('q').value.trim();
  if(!v)return;
  var lq=v.toLowerCase().replace(/\s+/g,'');
  // ë³„ì¹­ ë§¤í•‘
  if(AL[lq]){doSearch(AL[lq]+'.KS');return;}
  if(US_AL[lq]){doSearch(US_AL[lq]);return;}
  // 6ìë¦¬ ì½”ë“œ
  if(/^\d{6}$/.test(v)){doSearch(v+'.KS');return;}
  // ë¯¸êµ­ í‹°ì»¤
  var uMatch=US_DB.find(function(d){return d.c===v.toUpperCase();});
  if(uMatch){doSearch(uMatch.c);return;}
  // ê·¸ëƒ¥ ê²€ìƒ‰ì–´ë¡œ API í˜¸ì¶œ ì‹œë„
  doSearch(v);
}

// â”€â”€ ì¸ê¸° ì¢…ëª© / í‹°ì»¤ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
var POP=[{c:'005930.KS',n:'ì‚¼ì„±ì „ì',m:'KOSPI'},{c:'000660.KS',n:'SKí•˜ì´ë‹‰ìŠ¤',m:'KOSPI'},
  {c:'035420.KS',n:'NAVER',m:'KOSPI'},{c:'NVDA',n:'NVIDIA',m:'NASDAQ'},
  {c:'AAPL',n:'Apple',m:'NASDAQ'},{c:'TSLA',n:'Tesla',m:'NASDAQ'}];
function loadPop(){
  var pg=G('popGrid');pg.innerHTML=POP.map(function(){return '<div class="sk"></div>';}).join('');
  Promise.all(POP.map(function(p){return apiStock({action:'quote',symbol:p.c}).then(function(q){return{ok:true,p:p,q:q};}).catch(function(){return{ok:false,p:p};});}))
  .then(function(res){
    pg.innerHTML=res.map(function(r){
      var p=r.p;var kr=isKR(p.c);
      if(!r.ok)return '<div class="pc2" data-c="'+p.c+'"><div class="psm">'+p.c+' Â· '+p.m+'</div><div class="pn">'+p.n+'</div><div class="pp" style="color:#484f58">â€”</div><div class="pch na">ì˜¤ë¥˜</div></div>';
      var q=r.q;var up=(q.changePct||0)>=0;
      return '<div class="pc2" data-c="'+p.c+'"><div class="psm">'+p.c+' Â· '+p.m+'</div><div class="pn">'+(q.name||p.n)+'</div><div class="pp">'+fP(q.price,kr)+'</div><div class="pch '+(up?'up':'dn')+'">'+fPct(q.changePct)+'</div></div>';
    }).join('');
    pg.querySelectorAll('.pc2').forEach(function(el){el.addEventListener('click',function(){doSearch(el.getAttribute('data-c'));});});
  });
}
function loadTicker(){
  var T=[{c:'005930.KS',n:'ì‚¼ì„±ì „ì'},{c:'000660.KS',n:'SKí•˜ì´ë‹‰ìŠ¤'},{c:'035420.KS',n:'NAVER'},
         {c:'NVDA',n:'NVIDIA'},{c:'AAPL',n:'Apple'},{c:'TSLA',n:'Tesla'},{c:'MSFT',n:'Microsoft'},{c:'035720.KS',n:'ì¹´ì¹´ì˜¤'}];
  Promise.all(T.map(function(t){return apiStock({action:'quote',symbol:t.c}).then(function(q){return{ok:true,t:t,price:q.price,pct:q.changePct,kr:isKR(t.c)};}).catch(function(){return null;});}))
  .then(function(res){
    var items=res.filter(function(r){return r&&r.ok;});
    if(!items.length){G('tbTrack').innerHTML='<span style="color:#484f58;font-size:.75rem;font-family:\'JetBrains Mono\',monospace">_worker.js ë°°í¬ í›„ ì´ìš© ê°€ëŠ¥</span>';return;}
    function mk(){return items.map(function(it){var up=(it.pct||0)>=0,ps=it.kr?fN(it.price,0)+'ì›':'$'+fN(it.price,2);return '<span class="ti" data-c="'+it.t.c+'"><b>'+it.t.n+'</b>'+ps+'<span class="'+(up?'cu':'cd')+'">'+fPct(it.pct)+'</span></span>';}).join('');}
    var track=G('tbTrack');track.innerHTML=mk()+mk();
    track.querySelectorAll('.ti').forEach(function(el){el.addEventListener('click',function(){doSearch(el.getAttribute('data-c'));});});
  });
}

// â”€â”€ ì´ë²¤íŠ¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
G('btn').addEventListener('click',searchFromInput);
G('q').addEventListener('keydown',function(e){
  var items=G('sug').querySelectorAll('.sg');
  if(e.key==='ArrowDown'){e.preventDefault();sugIdx=Math.min(sugIdx+1,items.length-1);items.forEach(function(el,i){el.classList.toggle('active',i===sugIdx);});}
  else if(e.key==='ArrowUp'){e.preventDefault();sugIdx=Math.max(sugIdx-1,-1);items.forEach(function(el,i){el.classList.toggle('active',i===sugIdx);});}
  else if(e.key==='Enter'){
    if(sugIdx>=0&&items[sugIdx]){items[sugIdx].click();}
    else{hideSug();searchFromInput();}
  }
  else if(e.key==='Escape')hideSug();
});
G('q').addEventListener('input',function(e){
  clearTimeout(sugT);
  sugT=setTimeout(function(){showSug(e.target.value);},200);
});
document.addEventListener('click',function(e){if(!e.target.closest('.sw'))hideSug();});
document.querySelectorAll('.chip').forEach(function(chip){
  chip.addEventListener('click',function(){document.querySelectorAll('.chip').forEach(function(c){c.classList.remove('on');});chip.classList.add('on');});
});

// â”€â”€ ì´ˆê¸°í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
fetch('/api/health').then(function(r){var ct=r.headers.get('content-type')||'';if(!ct.includes('json'))showBanner();}).catch(function(){showBanner();});
loadTicker();
loadPop();
})();
</script>
</body>
</html>
