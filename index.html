<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>KRX AI ë§¤ë§¤ ì „ëµ ë¶„ì„ê¸°</title>

<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>

<style>
body{
    margin:0;
    font-family:Arial;
    background:#0e1117;
    color:white;
}

header{
    text-align:center;
    padding:40px 20px;
    font-size:28px;
    font-weight:bold;
}

.container{
    max-width:1200px;
    margin:auto;
    padding:20px;
}

.controls{
    display:flex;
    gap:10px;
    margin-bottom:20px;
}

input{
    flex:1;
    padding:12px;
    border-radius:8px;
    border:none;
    font-size:16px;
}

button{
    background:#16c784;
    border:none;
    color:white;
    font-weight:bold;
    padding:12px 20px;
    border-radius:8px;
    cursor:pointer;
}

.cards{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:10px;
    margin:20px 0;
}

.card{
    background:#1b222c;
    padding:20px;
    border-radius:12px;
    text-align:center;
}

.card h3{
    margin:0;
    font-size:14px;
    opacity:.7;
}

.card p{
    font-size:22px;
    font-weight:bold;
    margin:10px 0 0;
}

#chart{
    height:600px;
}

#comment{
    margin-top:30px;
    background:#1b222c;
    padding:20px;
    border-radius:12px;
    line-height:1.6;
}
</style>
</head>

<body>

<header>
ğŸ“ˆ KRX AI ë§¤ë§¤ ì „ëµ ë¶„ì„ê¸°
</header>

<div class="container">

<div class="controls">
    <input id="ticker" placeholder="í‹°ì»¤ ì…ë ¥ (ì˜ˆ: 005930.KS)" />
    <button onclick="run()">ë¬´ë£Œ ë¶„ì„ ì‹œì‘ â†’</button>
</div>

<div class="cards">
    <div class="card"><h3>í˜„ì¬ê°€</h3><p id="cur">-</p></div>
    <div class="card"><h3>ë§¤ìˆ˜</h3><p id="buy">-</p></div>
    <div class="card"><h3>ì†ì ˆ</h3><p id="stop">-</p></div>
    <div class="card"><h3>ëª©í‘œ</h3><p id="target">-</p></div>
</div>

<div id="chart"></div>
<div id="comment"></div>

</div>

<script>

function mean(arr){
    return arr.reduce((a,b)=>a+b,0)/arr.length;
}

function std(arr){
    const m = mean(arr);
    return Math.sqrt(mean(arr.map(x => (x-m)**2)));
}

async function run(){

    const ticker = document.getElementById("ticker").value.trim();

    if(!ticker){
        alert("í‹°ì»¤ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: 005930.KS)");
        return;
    }

    const url = `https://query1.finance.yahoo.com/v8/finance/chart/${ticker}?range=2y&interval=1d`;

    const res = await fetch(url);
    const data = await res.json();

    const quote = data.chart.result[0];
    const close = quote.indicators.quote[0].close;

    const prices = close.filter(x=>x);

    const current = prices.at(-1);

    const ma20 = mean(prices.slice(-20));
    const ma60 = mean(prices.slice(-60));

    const returns = prices.slice(1).map((p,i)=>(p-prices[i])/prices[i]);
    const vol = std(returns);

    const buy = ma20 * 0.98;
    const stop = buy * (1 - vol*3);
    const target = buy * 1.2;

    document.getElementById("cur").innerText = current.toFixed(0);
    document.getElementById("buy").innerText = buy.toFixed(0);
    document.getElementById("stop").innerText = stop.toFixed(0);
    document.getElementById("target").innerText = target.toFixed(0);

    Plotly.newPlot("chart",[
        {y:prices, name:"Price"},
        {y:prices.map((_,i)=> i<20?null:mean(prices.slice(i-20,i))), name:"MA20"},
        {y:prices.map((_,i)=> i<60?null:mean(prices.slice(i-60,i))), name:"MA60"},
    ]);

    document.getElementById("comment").innerHTML = `
    <h3>ğŸ¤– AI ì „ëµ ë¶„ì„</h3>
    ë§¤ìˆ˜ ì¶”ì²œê°€: ${buy.toFixed(0)}ì›<br>
    ì†ì ˆê°€: ${stop.toFixed(0)}ì›<br>
    ëª©í‘œê°€: ${target.toFixed(0)}ì›<br>
    ë³€ë™ì„±: ${(vol*100).toFixed(2)}%<br>
    ğŸ‘‰ ë‹¨ê¸° ëˆŒë¦¼ëª© ë§¤ìˆ˜ ì „ëµ
    `;
}

document.getElementById("ticker").addEventListener("keydown", e=>{
    if(e.key==="Enter") run();
});
</script>

</body>
</html>
